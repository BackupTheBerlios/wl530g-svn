diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/boot/compressed/head.S linux-2.4.32-uc0-wl530g/arch/armnommu/boot/compressed/head.S
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/boot/compressed/head.S	2004-04-01 07:25:01.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/boot/compressed/head.S	2006-09-10 12:52:01.000000000 +0300
@@ -214,6 +214,10 @@
 #else
 		mrc	p15, 0, r6, c0, c0	@ get processor ID
 		bl	cache_on
+
+#ifdef CONFIG_LIBERTAS_AP32
+               bl      mpu_regions_set
+#endif
 #endif
 #endif	
 
@@ -631,6 +635,91 @@
 		mov	pc, r10
 #endif
 
+#ifdef CONFIG_LIBERTAS_AP32
+
+		.align 5
+mpu_regions_set:
+
+
+/* initialize MPU:
+ * ----------------------------
+ * region 0 - background for all address space.
+ *	    - 0x0000.0000 - 0xFFFF.FFFF (uncachable, unbufferable)
+ * region 1 - make flash to be cachable to speed up the
+ *          - speed of decompression of kernel
+ */
+
+/* TODO - close this into a nice loop instead of this silly chain */
+	/* Define the regions */
+	adr	r0, REGION0
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c0, 0
+	adr	r0, REGION1
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c1, 0
+	adr	r0, REGION2
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c2, 0
+	adr	r0, REGION3
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c3, 0
+	adr	r0, REGION4
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c4, 0
+	adr	r0, REGION5
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c5, 0
+	adr	r0, REGION6
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c6, 0
+	adr	r0, REGION7
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c7, 0
+
+	/* set cachable / non-cacheable */
+	/* move #2 into r0 = binary(00000010), which means only region #1 */
+	mov	r0, #2
+	/* data cache */
+	mcr	p15, 0, r0, c2, c0, 0
+	/* instruction cache */
+	mcr	p15, 0, r0, c2, c0, 1
+
+	/* set bufferable / non-bufferable */
+	mcr	p15, 0, r0, c3, c0, 0
+
+	/* set permissions for all regions */
+	adr	r0, ALL_PERMITED
+	ldmia	r0, {r0}
+	/* data access permissions */
+	mcr	p15, 0, r0, c5, c0, 2
+	/* instructions access permissions */
+	mcr	p15, 0, r0, c5, c0, 3
+
+	/* enable PU */
+	/* read current state, and turn on I+D caches and the PU */
+	mrc	p15, 0, r0, c1, c0, 0
+	/* (ICache | DCache | PU) = (BIT12 | BIT2 | BIT0) */
+	adr	r1, CONTROL_MASK
+	ldmia	r1, {r1}
+	orr	r0, r1, r0
+	mcr	p15, 0, r0, c1, c0, 0
+	mov	pc, lr
+
+REGION0:	.long	0x0000003F
+REGION1:	.long	0xFFC0002B
+REGION2:	.long	0x0
+REGION3:	.long	0x0
+REGION4:	.long	0x0
+REGION5:	.long	0x0
+REGION6:	.long	0x0
+REGION7:	.long	0x0
+ALL_PERMITED:	.long   0x33333333
+CONTROL_MASK:	.long   0x00001005
+
+/* End of MPU initialization. */
+
+#endif
+
 reloc_end:
 
 		.align
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/boot/compressed/vmlinux.lds.in linux-2.4.32-uc0-wl530g/arch/armnommu/boot/compressed/vmlinux.lds.in
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/boot/compressed/vmlinux.lds.in	2001-10-02 12:35:12.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/boot/compressed/vmlinux.lds.in	2006-09-10 13:45:26.000000000 +0300
@@ -14,7 +14,7 @@
   . = LOAD_ADDR;
   _load_addr = .;
 
-  . = TEXT_START;
+  . = TEXT_START + 0x20;
   _text = .;
 
   .text : {
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/boot/Makefile linux-2.4.32-uc0-wl530g/arch/armnommu/boot/Makefile
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/boot/Makefile	2005-03-02 07:30:24.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/boot/Makefile	2006-09-10 12:50:50.000000000 +0300
@@ -131,6 +131,18 @@
 ZTEXTADDR	 = 0x10000000
 endif
 
+ifeq ($(CONFIG_ARCH_FIREFOX),y)
+ZTEXTADDR	= $(FLASH_MEM_BASE)
+ZRELADDR	= $(DRAM_BASE)
+ZBSSADDR	= 0x00300000
+endif
+
+ifeq ($(CONFIG_ARCH_LIBERTAS),y)
+ZTEXTADDR	= $(FLASH_MEM_BASE)
+ZRELADDR	= $(TEXTADDR)
+ZBSSADDR	= 0xd0300000
+endif
+
 #
 # If you don't define ZRELADDR above,
 # then it defaults to ZTEXTADDR
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/config.in linux-2.4.32-uc0-wl530g/arch/armnommu/config.in
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/config.in	2005-12-07 16:10:28.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/config.in	2006-09-10 14:31:38.000000000 +0300
@@ -66,7 +66,9 @@
 	  uC-C5471DSP		CONFIG_MACH_UC5471DSP \
 	  SJ5471-ENG		CONFIG_MACH_SJ5471ENG \
 	  iPod			CONFIG_ARCH_IPOD \
-	  Winbond		CONFIG_ARCH_WINBOND" TI-DSC21
+	  Winbond		CONFIG_ARCH_WINBOND \
+	  Firefox		CONFIG_ARCH_FIREFOX \
+	  Libertas		CONFIG_ARCH_LIBERTAS" Libertas
 
 if [ "$CONFIG_ARCH_TA7V" = "y" ]; then
    choice ' Triscend A7V Derivative' \
@@ -80,6 +82,47 @@
    bool 'Generate big endian code' CONFIG_CPU_BIG_ENDIAN
 fi
 
+if [ "$CONFIG_ARCH_LIBERTAS" = "y" ]; then
+        choice 'Libertas machine' \
+                "AP22           CONFIG_LIBERTAS_AP22  \
+                 AP32           CONFIG_LIBERTAS_AP32" \
+                AP32
+fi
+
+if [ "$CONFIG_ARCH_FIREFOX" = "y" ]; then
+        choice 'Firefox machine' \
+                "DB-88E62x8     CONFIG_FIREFOX_DBFF  \
+                 RD-88E62x8     CONFIG_FIREFOX_RDFF" \
+                RD-88E62x8
+fi
+
+bool 'Default bootloader kernel arguments' CONFIG_CMDLINE_BOOL
+if [ "$CONFIG_CMDLINE_BOOL" = "y" ] ; then
+   string 'Initial kernel command string' CONFIG_CMDLINE \
+               "console=ttyS0,38400 root=/dev/mtdblock1 ro rootfstype=cramfs"
+fi
+
+bool '  ARM946 CPU idle' CONFIG_CPU_ARM946_CPU_IDLE
+bool '  ARM946 I-Cache on' CONFIG_CPU_ARM946_I_CACHE_ON
+bool '  ARM946 D-Cache on' CONFIG_CPU_ARM946_D_CACHE_ON
+if [ "$CONFIG_CPU_ARM946_D_CACHE_ON" = "y" ] ; then
+   bool '  Force write through caches on ARM946' \
+                CONFIG_CPU_ARM946_WRITETHROUGH
+fi
+
+if [ "$CONFIG_ARCH_LIBERTAS" = "y" ]; then
+   if [ "$CONFIG_LIBERTAS_AP32" = "y" ]; then
+      choice 'System Clock' \
+         "128MHz  CONFIG_128MHZ_CLOCK \
+          160MHz  CONFIG_160MHZ_CLOCK" \
+          128MHz
+      choice 'Memory Size' \
+         "8M      CONFIG_8M_MEM \
+          16M     CONFIG_16M_MEM" \
+          16M
+   fi
+fi
+
 if [ "$CONFIG_ARCH_CNXT" = "y" ]; then
    choice ' Conexant/Mindspeed architecture' \
    	" P52xxCtrl		CONFIG_ARCH_P52 \
@@ -163,6 +206,10 @@
    hex '(S)DRAM Size ' DRAM_SIZE 0x00800000
    hex 'FLASH Base Address ' FLASH_MEM_BASE 0x00400000
    hex 'FLASH Size ' FLASH_SIZE 0x00400000
+   hex 'ROMFS Address in FLASH ' FLASH_ROMFS_BASE 0xffca0000
+   if [ "$CONFIG_LIBERTAS_AP32" = "y" ]; then
+      hex 'JFFS2 Address in FLASH ' FLASH_JFFS2_BASE 0xfff80000
+   fi
 fi
 
 if [ "$CONFIG_ARCH_TA7S" != "y" -a "$CONFIG_ARCH_TA7V" != "y" ]; then
@@ -171,6 +218,60 @@
      ROM	CONFIG_ROMKERNEL" ROM
 fi
 
+if [ "$CONFIG_ARCH_LIBERTAS" = "y" ]; then
+   define_bool CONFIG_NO_PGT_CACHE y
+   define_bool CONFIG_CPU_ARM946 y
+   define_bool CONFIG_CPU_32 y
+   define_bool CONFIG_CPU_26 n
+   define_bool CONFIG_CPU_WITH_CACHE y
+   define_bool CONFIG_CPU_WITH_MCR_INSTRUCTION y
+   define_bool CONFIG_CMDLINE_BOOL y
+   if [ "$CONFIG_LIBERTAS_AP22" = "y" ]; then
+      define_hex DRAM_BASE 0xd0000000
+      define_hex DRAM_SIZE 0x7d6000
+      define_hex FLASH_MEM_BASE 0xffe00000
+      define_hex FLASH_SIZE 0x200000
+      define_hex FLASH_ROMFS_BASE 0xffea0000
+   fi
+   if [ "$CONFIG_LIBERTAS_AP32" = "y" ]; then
+      define_hex DRAM_BASE 0xd0000000
+      if [ "$CONFIG_8M_MEM" = "y" ]; then
+         define_hex DRAM_SIZE 0x7C0000
+      fi
+      if [ "$CONFIG_16M_MEM" = "y" ]; then
+         define_hex DRAM_SIZE 0xfC0000
+      fi
+      define_hex FLASH_MEM_BASE 0xffc00000
+      define_hex FLASH_SIZE 0x400000
+      define_hex FLASH_ROMFS_BASE 0xffca0000
+      define_hex FLASH_JFFS2_BASE 0xfff80000
+   fi
+fi
+
+if [ "$CONFIG_ARCH_FIREFOX" = "y" ]; then
+        define_bool CONFIG_NO_PGT_CACHE y
+        define_bool CONFIG_CPU_ARM946 y
+        define_bool CONFIG_CPU_32 y
+        define_bool CONFIG_CPU_26 n
+        define_bool CONFIG_CPU_WITH_CACHE y
+        define_bool CONFIG_CPU_WITH_MCR_INSTRUCTION y
+        define_bool CONFIG_ROOT_CRAMFS_AS_IMAGE y
+        if [ "$CONFIG_FIREFOX_DBFF" = "y" ]; then
+                define_hex DRAM_BASE 0xd0000000
+                define_hex DRAM_SIZE 0x7d6000
+                define_hex FLASH_MEM_BASE 0x20000000
+                define_hex FLASH_SIZE 0x800000
+                define_hex FLASH_ROMFS_BASE 0x200c0000
+        fi
+        if [ "$CONFIG_FIREFOX_RDFF" = "y" ]; then
+                define_hex DRAM_BASE 0xd0000000
+                define_hex DRAM_SIZE 0x7d6000
+                define_hex FLASH_MEM_BASE 0xffc00000
+                define_hex FLASH_SIZE 0x400000
+                define_hex FLASH_ROMFS_BASE 0xffca0000
+        fi
+fi
+
 # ARM940T
 if [ "$CONFIG_ARCH_CNXT" = "y" ]; then
    define_bool CONFIG_CPU_32 y
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/arch.c linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/arch.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/arch.c	2005-10-06 05:48:35.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/arch.c	2006-09-10 12:49:22.000000000 +0300
@@ -177,6 +177,20 @@
 MACHINE_END
 #endif
 
+#ifdef CONFIG_ARCH_LIBERTAS
+void __init
+fixup_libertas(struct machine_desc *desc, struct param_struct *params,
+             char **cmdline, struct meminfo *mi)
+{
+#ifdef CONFIG_BLK_DEV_INITRD
+	setup_ramdisk(1, 0, 0, CONFIG_BLK_DEV_RAM_SIZE);
+//        setup_initrd((int)&__ramdisk_data,
+//	             (int)&__ramdisk_data_end - (int)&__ramdisk_data);
+        setup_initrd((unsigned long)0xd0600000, (unsigned long)1048576);
+#endif
+}
+#endif
+
 #ifdef CONFIG_ARCH_NETARM
 #include <asm/arch/netarm_registers.h>
 #include <asm/arch/netarm_mmap.h>
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/armksyms.c linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/armksyms.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/armksyms.c	2001-10-02 12:35:12.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/armksyms.c	2006-09-10 12:49:22.000000000 +0300
@@ -76,6 +76,12 @@
 extern void fpundefinstr(void);
 extern void fp_enter(void);
 
+/*
+ * This has a special calling convention; it doesn't
+ * modify any of the usual registers, except for LR.
+ */
+extern void __do_softirq(void);
+
 #define EXPORT_SYMBOL_ALIAS(sym,orig)		\
  const char __kstrtab_##sym##[]			\
   __attribute__((section(".kstrtab"))) =	\
@@ -101,6 +107,8 @@
 EXPORT_SYMBOL(kd_mksound);
 #endif
 
+EXPORT_SYMBOL_NOVERS(__do_softirq);
+
 	/* platform dependent support */
 EXPORT_SYMBOL(dump_thread);
 EXPORT_SYMBOL(dump_fpu);
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/entry-armv.S linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/entry-armv.S
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/entry-armv.S	2006-02-27 09:27:28.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/entry-armv.S	2006-09-10 12:55:41.000000000 +0300
@@ -1432,6 +1432,58 @@
 		.macro  irq_prio_table
 		.endm
 
+#elif defined(CONFIG_ARCH_FIREFOX)
+		.macro  disable_fiq
+		.endm
+		.macro  get_irqnr_and_base, irqnr, irqstat, base, tmp
+		ldr     \irqstat, =FIREFOX_INT_STATUS
+		ldr     \irqstat, [\irqstat]
+		/* Timer interrupt */
+		tst     \irqstat, #IRQ_MASK_TIMER1
+		movne   \irqnr, #IRQ_TIMER1
+		bne     1002f
+		/* uART interrupt */
+		tst     \irqstat, #IRQ_MASK_UART
+		movne   \irqnr, #IRQ_UART
+		bne     1002f
+		/* Ethernet interrupt */
+		tst     \irqstat, #IRQ_MASK_FE
+		movne   \irqnr, #IRQ_FE
+		bne     1002f
+1002:
+		.endm
+
+		.macro  irq_prio_table
+		.endm
+
+#elif defined(CONFIG_ARCH_LIBERTAS)
+		.macro  disable_fiq
+		.endm
+		.macro  get_irqnr_and_base, irqnr, irqstat, base, tmp
+		ldr     \irqstat, =LIBERTAS_INT_STATUS
+		ldr     \irqstat, [\irqstat]
+		/* Timer interrupt */
+		tst     \irqstat, #IRQ_MASK_TIMER1
+		movne   \irqnr, #IRQ_TIMER1
+		bne     1002f
+		/* uART interrupt */
+		tst     \irqstat, #IRQ_MASK_UART
+		movne   \irqnr, #IRQ_UART
+		bne     1002f
+		/* Ethernet interrupt */
+		tst     \irqstat, #IRQ_MASK_FE
+		movne   \irqnr, #IRQ_FE
+		bne     1002f
+		/* WLAN interrupt */
+		tst     \irqstat, #IRQ_MASK_WLAN
+		movne   \irqnr, #IRQ_WLAN
+		bne     1002f
+1002:
+		.endm
+
+		.macro  irq_prio_table
+		.endm
+ 
 #else
 #error Unknown architecture
 #endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/head-armv.S linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/head-armv.S
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/head-armv.S	2005-12-07 16:10:28.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/head-armv.S	2006-09-10 12:58:35.000000000 +0300
@@ -225,6 +225,17 @@
 		ldr	r1, pMACH_TYPE_UC5471DSP
 #elif defined(CONFIG_MACH_SJ5471ENG)
 		ldr	r1, pMACH_TYPE_SJC5471ENG
+#elif defined(CONFIG_ARCH_LIBERTAS)
+		/*
+		 * Enable i-SRAM at 0
+		 */
+		mrc     p15, 0, r1, c1, c0, 0
+		orr     r1, r1, #0x40000
+		mcr     p15, 0, r1, c1, c0, 0
+
+		mov     r1, #MACH_TYPE_LIBERTAS
+#elif defined(CONFIG_ARCH_FIREFOX)
+		mov     r1, #MACH_TYPE_FIREFOX
 #elif defined(CONFIG_ARCH_LPC)
 		mov r1, #MACH_TYPE_LPC22XX & 0xff
 		orr r1, r1, #MACH_TYPE_LPC22XX & 0xff00
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/process.c linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/process.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/kernel/process.c	2004-01-12 02:28:56.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/kernel/process.c	2006-09-10 12:49:22.000000000 +0300
@@ -126,10 +126,12 @@
 
 void machine_restart(char * __unused)
 {
+#if 0
 	/*
 	 * Clean and disable cache, and turn off interrupts
 	 */
 	cpu_proc_fin();
+#endif	
 
 	/*
 	 * Tell the mm system that we are going to reboot -
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-firefox/arch.c linux-2.4.32-uc0-wl530g/arch/armnommu/mach-firefox/arch.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-firefox/arch.c	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-firefox/arch.c	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,26 @@
+/*
+ *  linux/arch/arm/mach-firefox/arch.c
+ *
+ *  Architecture specific fixups.  This is where any
+ *  parameters in the params struct are fixed up, or
+ *  any additional architecture specific information
+ *  is pulled from the params struct.
+ */
+#include <linux/tty.h>
+#include <linux/delay.h>
+#include <linux/pm.h>
+#include <linux/init.h>
+
+#include <asm/elf.h>
+#include <asm/setup.h>
+#include <asm/mach-types.h>
+#include <asm/mach/arch.h>
+
+extern void genarch_init_irq(void);
+
+MACHINE_START(FIREFOX, "MV88E62x8")
+     BOOT_MEM(0x00020000, 0xffffffff, 0xffffffff)
+     /* If the last 2 parmas are 0... head-armv.S will return 0 for the arch... */
+     MAINTAINER("Marvell")
+     INITIRQ(genarch_init_irq)
+MACHINE_END
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-firefox/irq.c linux-2.4.32-uc0-wl530g/arch/armnommu/mach-firefox/irq.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-firefox/irq.c	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-firefox/irq.c	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,73 @@
+/*
+ *  linux/arch/arm/mach-firefox/irq.c
+ *
+ *  Copyright (C) 1999 ARM Limited
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#include <linux/init.h>
+
+#include <asm/mach/irq.h>
+#include <asm/hardware.h>
+#include <asm/io.h>
+#include <asm/irq.h>
+#include <asm/system.h>
+
+void firefox_mask_irq(unsigned int irq)
+{
+    *((u32*)FIREFOX_INT_ENABLE_CLR) = (1 << irq);
+}	
+
+void firefox_unmask_irq(unsigned int irq)
+{
+    *((u32*)FIREFOX_INT_ENABLE_SET) = (1 << irq);
+}
+
+void firefox_mask_ack_irq(unsigned int irq)
+{
+    firefox_mask_irq(irq);
+    switch(irq) {
+    case IRQ_TIMER1: /* TODO: change timer1 to timer2 for a better resolution (1Khz -> 1Mhz) */
+	inl(FIREFOX_TIMER_INT_SOURCE);
+	outl(1, FIREFOX_TIMER_INT_SOURCE);
+	break;
+    }
+
+}
+
+void 
+irq_init_irq(void)
+{
+  int irq;
+  
+  /* 
+   * Relocate execption vectors to address 0x0000000.
+   * This shouldn't be done here - but in an architecture global place.
+   */
+  __asm__ ("mrc  p15, 0, r0, c1, c0, 0;
+            ldr  r1, =0xffffdfff
+            and  r0, r1, r0;
+            mcr  p15, 0, r0, c1, c0, 0");
+
+	for (irq = 0; irq < NR_IRQS; irq++) {
+		irq_desc[irq].valid	= 1;
+		irq_desc[irq].probe_ok	= 1;
+		irq_desc[irq].mask_ack	= firefox_mask_ack_irq;
+		irq_desc[irq].mask	= firefox_mask_irq;
+		irq_desc[irq].unmask	= firefox_unmask_irq;
+	}
+}
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-firefox/Makefile linux-2.4.32-uc0-wl530g/arch/armnommu/mach-firefox/Makefile
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-firefox/Makefile	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-firefox/Makefile	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,21 @@
+#
+# Makefile for the linux kernel.
+#
+# Note! Dependencies are done automagically by 'make dep', which also
+# removes any old dependencies. DON'T put your own dependencies here
+# unless it's something special (ie not a .c file).
+
+USE_STANDARD_AS_RULE := true
+
+O_TARGET		:= firefox.o
+
+# Object file lists.
+
+obj-y			:= $(patsubst %.c, %.o, $(wildcard *.c))
+obj-m			:=
+obj-n			:=
+obj-			:=
+
+export-objs		:= 
+
+include $(TOPDIR)/Rules.make
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-firefox/time.c linux-2.4.32-uc0-wl530g/arch/armnommu/mach-firefox/time.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-firefox/time.c	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-firefox/time.c	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,31 @@
+/*
+ * time.c  Timer functions for Firefox
+ */
+
+#include <linux/time.h>
+#include <linux/timex.h>
+#include <linux/types.h>
+#include <linux/sched.h>
+#include <asm/io.h>
+#include <asm/arch/hardware.h>
+
+extern unsigned long firefox_gettimeoffset(void)
+{
+	u16 elapsed;
+	u16 latch;
+	/* 
+	 * Compute the elapsed count. The current count tells us how
+	 * many counts remain until the next interrupt. latch tells us
+	 * how many counts total occur between interrupts. Subtract to
+	 * get the counts since the last interrupt. Borrowed for Firefox
+	 * from dsc21
+	 */
+	latch = inw(FIREFOX_TIMER1_LENGTH);
+	elapsed = latch - inw(FIREFOX_TIMER1_VALUE);
+	return (unsigned long)((elapsed * tick) / latch);
+}
+
+void firefox_timer_interrupt(int irq, void *dev_id, struct pt_regs *regs)
+{
+	do_timer(regs);
+}
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/arch.c linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/arch.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/arch.c	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/arch.c	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,28 @@
+/*
+ *  linux/arch/arm/mach-libertas/arch.c
+ *
+ *  Architecture specific fixups.  This is where any
+ *  parameters in the params struct are fixed up, or
+ *  any additional architecture specific information
+ *  is pulled from the params struct.
+ */
+#include <linux/tty.h>
+#include <linux/delay.h>
+#include <linux/pm.h>
+#include <linux/init.h>
+
+#include <asm/elf.h>
+#include <asm/setup.h>
+#include <asm/mach-types.h>
+#include <asm/mach/arch.h>
+
+extern void genarch_init_irq(void);
+extern void fixup_libertas(struct machine_desc *desc, struct param_struct *params, char **cmdline, struct meminfo *mi);
+
+MACHINE_START(LIBERTAS, "MV88W85x0")
+     BOOT_MEM(0xD0000000, 0xffffffff, 0xffffffff)
+     /* If the last 2 parmas are 0... head-armv.S will return 0 for the arch... */
+     MAINTAINER("Marvell")
+     FIXUP(fixup_libertas)
+     INITIRQ(genarch_init_irq)
+MACHINE_END
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/irq.c linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/irq.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/irq.c	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/irq.c	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,73 @@
+/*
+ *  linux/arch/arm/mach-libertas/irq.c
+ *
+ *  Copyright (C) 1999 ARM Limited
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#include <linux/init.h>
+
+#include <asm/mach/irq.h>
+#include <asm/hardware.h>
+#include <asm/io.h>
+#include <asm/irq.h>
+#include <asm/system.h>
+
+void libertas_mask_irq(unsigned int irq)
+{
+    *((u32*)LIBERTAS_INT_ENABLE_CLR) = (1 << irq);
+}	
+
+void libertas_unmask_irq(unsigned int irq)
+{
+    *((u32*)LIBERTAS_INT_ENABLE_SET) = (1 << irq);
+}
+
+void libertas_mask_ack_irq(unsigned int irq)
+{
+    libertas_mask_irq(irq);
+    switch(irq) {
+    case IRQ_TIMER1: /* TODO: change timer1 to timer2 for a better resolution (1Khz -> 1Mhz) */
+	inl(LIBERTAS_TIMER_INT_SOURCE);
+	outl(1, LIBERTAS_TIMER_INT_SOURCE);
+	break;
+    }
+
+}
+
+void 
+irq_init_irq(void)
+{
+  int irq;
+  
+  /* 
+   * Relocate execption vectors to address 0x0000000.
+   * This shouldn't be done here - but in an architecture global place.
+   */
+  __asm__ ("mrc  p15, 0, r0, c1, c0, 0;
+            ldr  r1, =0xffffdfff
+            and  r0, r1, r0;
+            mcr  p15, 0, r0, c1, c0, 0");
+
+	for (irq = 0; irq < NR_IRQS; irq++) {
+		irq_desc[irq].valid	= 1;
+		irq_desc[irq].probe_ok	= 1;
+		irq_desc[irq].mask_ack	= libertas_mask_ack_irq;
+		irq_desc[irq].mask	= libertas_mask_irq;
+		irq_desc[irq].unmask	= libertas_unmask_irq;
+	}
+}
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/Makefile linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/Makefile
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/Makefile	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/Makefile	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,21 @@
+#
+# Makefile for the linux kernel.
+#
+# Note! Dependencies are done automagically by 'make dep', which also
+# removes any old dependencies. DON'T put your own dependencies here
+# unless it's something special (ie not a .c file).
+
+USE_STANDARD_AS_RULE := true
+
+O_TARGET		:= libertas.o
+
+# Object file lists.
+
+obj-y			:= $(patsubst %.c, %.o, $(wildcard *.c))
+obj-m			:=
+obj-n			:=
+obj-			:=
+
+export-objs		:= 
+
+include $(TOPDIR)/Rules.make
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/time.c linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/time.c
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/time.c	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/time.c	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,31 @@
+/*
+ * time.c  Timer functions for Libertas
+ */
+
+#include <linux/time.h>
+#include <linux/timex.h>
+#include <linux/types.h>
+#include <linux/sched.h>
+#include <asm/io.h>
+#include <asm/arch/hardware.h>
+
+extern unsigned long libertas_gettimeoffset(void)
+{
+	u16 elapsed;
+	u16 latch;
+	/* 
+	 * Compute the elapsed count. The current count tells us how
+	 * many counts remain until the next interrupt. latch tells us
+	 * how many counts total occur between interrupts. Subtract to
+	 * get the counts since the last interrupt. Borrowed for Libertas
+	 * from Firefox
+	 */
+	latch = inw(LIBERTAS_TIMER1_LENGTH);
+	elapsed = latch - inw(LIBERTAS_TIMER1_VALUE);
+	return (unsigned long)((elapsed * tick) / latch);
+}
+
+void libertas_timer_interrupt(int irq, void *dev_id, struct pt_regs *regs)
+{
+	do_timer(regs);
+}
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/vmlinux.lds linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/vmlinux.lds
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mach-libertas/vmlinux.lds	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mach-libertas/vmlinux.lds	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,120 @@
+/* ld script to make ARM Linux kernel
+ * taken from the i386 version by Russell King
+ * Written by Martin Mares <mj@atrey.karlin.mff.cuni.cz>
+ */
+OUTPUT_ARCH(arm)
+ENTRY(stext)
+MEMORY
+{
+	. = 0xD0020000;
+}
+SECTIONS
+{
+	. = 0xD0020000;
+	.init : {			/* Init code and data		*/
+		_stext = .;
+		__init_begin = .;
+			*(.text.init)
+		__proc_info_begin = .;
+			*(.proc.info)
+		__proc_info_end = .;
+		__arch_info_begin = .;
+			*(.arch.info)
+		__arch_info_end = .;
+			*(.data.init)
+		. = ALIGN(16);
+		__setup_start = .;
+			*(.setup.init)
+		__setup_end = .;
+		__initcall_start = .;
+			*(.initcall.init)
+		__initcall_end = .;
+		. = ALIGN(4096);
+		__init_end = .;
+	}
+
+	/DISCARD/ : {			/* Exit code and data		*/
+		*(.text.exit)
+		*(.data.exit)
+		*(.exitcall.exit)
+	}
+
+	.text : {			/* Real text segment		*/
+		_text = .;		/* Text and read-only data	*/
+			*(.text)
+			*(.fixup)
+			*(.gnu.warning)
+			*(.text.lock)	/* out-of-line lock text */
+			*(.rodata)
+			*(.glue_7)
+			*(.glue_7t)
+			*(.kstrtab)
+		. = ALIGN(16);
+		__start___ex_table = .;	/* Exception table		*/
+			*(__ex_table)
+		__stop___ex_table = .;
+
+		__start___ksymtab = .;	/* Kernel symbol table		*/
+			*(__ksymtab)
+		__stop___ksymtab = .;
+
+		__start___kallsyms = .; /* All kernel symbols           */
+			*(__kallsyms)
+		__stop___kallsyms = .;
+
+		*(.got)			/* Global offset table		*/
+		
+		_etext = .;		/* End of text section		*/
+	}
+
+	. = ALIGN(8192);
+
+	.data : {
+		/*
+		 * first, the init task union, aligned
+		 * to an 8192 byte boundary.
+		 */
+		*(.init.task)
+
+		/*
+		 * then the cacheline aligned data
+		 */
+		. = ALIGN(32);
+		*(.data.cacheline_aligned)
+
+		/*
+		 * and the usual data section
+		 */
+		*(.data)
+		CONSTRUCTORS
+
+		_edata = .;
+	}
+
+	.bss : {
+		__bss_start = .;	/* BSS				*/
+		*(.bss)
+		*(COMMON)
+    . = ALIGN(0x10); 
+		_end = . ;
+    _ebss = . ;
+	}
+
+
+	. = ALIGN(8192);
+	_end_kernel = . ;
+
+					/* Stabs debugging sections.	*/
+	.stab 0 : { *(.stab) }
+	.stabstr 0 : { *(.stabstr) }
+	.stab.excl 0 : { *(.stab.excl) }
+	.stab.exclstr 0 : { *(.stab.exclstr) }
+	.stab.index 0 : { *(.stab.index) }
+	.stab.indexstr 0 : { *(.stab.indexstr) }
+	.comment 0 : { *(.comment) }
+	.debug_abbrev 0 : { *(.debug_abbrev) }
+	.debug_info 0 : { *(.debug_info) }
+	.debug_line 0 : { *(.debug_line) }
+	.debug_pubnames 0 : { *(.debug_pubnames) }
+	.debug_aranges 0 : { *(.debug_aranges) }
+}
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/Makefile linux-2.4.32-uc0-wl530g/arch/armnommu/Makefile
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/Makefile	2006-07-28 07:56:58.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/Makefile	2006-09-10 13:01:27.000000000 +0300
@@ -178,6 +178,16 @@
 MACHINE		= okim67x
 endif
 
+ifeq ($(CONFIG_ARCH_FIREFOX),y)
+TEXTADDR	= 0x00020000
+MACHINE		= firefox
+endif
+
+ifeq ($(CONFIG_ARCH_LIBERTAS),y)
+TEXTADDR	= 0xD0020000
+MACHINE		= libertas
+endif
+
 ifeq ($(CONFIG_ARCH_NETARM),y)
 MACHINE 	 = netarm
 # This allows it to use the internal bootloader.
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mm/Makefile linux-2.4.32-uc0-wl530g/arch/armnommu/mm/Makefile
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mm/Makefile	2005-07-07 13:51:46.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mm/Makefile	2006-09-10 12:59:10.000000000 +0300
@@ -49,6 +49,7 @@
 p-$(CONFIG_CPU_ARM720T)	+= proc-arm720.o
 p-$(CONFIG_CPU_ARM740T) += proc-arm740.o
 p-$(CONFIG_CPU_ARM920T)	+= proc-arm920.o
+p-$(CONFIG_CPU_ARM946)	+= proc-arm946.o
 
 p-$(CONFIG_CPU_OKIM67400X) += proc-oki-ml674001.o
 p-$(CONFIG_CPU_OKIM67500X) += proc-oki-ml675001.o
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/mm/proc-arm946.S linux-2.4.32-uc0-wl530g/arch/armnommu/mm/proc-arm946.S
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/mm/proc-arm946.S	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/mm/proc-arm946.S	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,605 @@
+/*
+ *  linux/arch/arm/mm/arm946.S: PU functions for ARM946
+ *  2001 Minspeed
+ */
+#include <linux/linkage.h>
+#include <linux/config.h>
+#include <asm/assembler.h>
+#include <asm/constants.h>
+#include <asm/procinfo.h>
+#include <asm/hardware.h>
+
+/*
+ * This is the maximum size of an area which will be invalidated
+ * using the single invalidate entry instructions.  Anything larger
+ * than this, and we go for the whole cache.
+ *
+ * This value should be chosen such that we choose the cheapest
+ * alternative.
+ */
+#define MAX_AREA_SIZE	16384
+
+/*
+ * the cache line size of the I and D cache
+ */
+#define DCACHELINESIZE	32
+#define ICACHELINESIZE	32
+
+/*
+ * and the page size
+ */
+#define PAGESIZE	4096
+
+	.text
+
+/*
+ * cpu_arm946_data_abort()
+ *
+ * obtain information about current aborted instruction
+ *
+ * r0 = address of aborted instruction
+ *
+ * Returns:
+ *  r0 = address of abort
+ *  r1 != 0 if writing
+ *  r3 = FSR
+ */
+	.align	5
+ENTRY(cpu_arm946_data_abort)
+	ldr	r1, [r0]			@ read aborted instruction
+	mrc	p15, 0, r0, c6, c0, 0		@ get FAR
+	tst	r1, r1, lsr #21			@ C = bit 20
+	mrc	p15, 0, r3, c5, c0, 0		@ get FSR
+	sbc	r1, r1, r1			@ r1 = C - 1
+	and	r3, r3, #255
+	mov	pc, lr
+/*
+ * cpu_arm946_check_bugs()
+ */
+ENTRY(cpu_arm946_check_bugs)
+	mrs	ip, cpsr
+	bic	ip, ip, #F_BIT
+	msr	cpsr, ip
+	mov	pc, lr
+
+/*
+ * cpu_arm946_proc_init()
+ */
+ENTRY(cpu_arm946_proc_init)
+	mov	pc, lr
+
+/*
+ * cpu_arm946_proc_fin()
+ */
+ENTRY(cpu_arm946_proc_fin)
+	stmfd	sp!, {lr}
+	mov	ip, #F_BIT | I_BIT | SVC_MODE
+	msr	cpsr_c, ip
+	bl	cpu_arm946_cache_clean_invalidate_all
+	mrc	p15, 0, r0, c1, c0, 0		@ ctrl register
+	bic	r0, r0, #0x1000			@ ...i............
+	bic	r0, r0, #0x000e			@ ............wca.
+	mcr	p15, 0, r0, c1, c0, 0		@ disable caches
+	ldmfd	sp!, {pc}
+
+/*
+ * cpu_arm946_reset(loc)
+ *
+ * Perform a soft reset of the system.  Put the CPU into the
+ * same state as it would be if it had been reset, and branch
+ * to what would be the reset vector.
+ *
+ * loc: location to jump to for soft reset
+ */
+	.align	5
+ENTRY(cpu_arm946_reset)
+	mov	ip, #0
+	mcr	p15, 0, ip, c7, c7, 0		@ invalidate I,D caches
+	mrc	p15, 0, ip, c1, c0, 0		@ ctrl register
+	bic	ip, ip, #0x000f			@ ............wcam
+	bic	ip, ip, #0x1100			@ ...i...s........
+	mcr	p15, 0, ip, c1, c0, 0		@ ctrl register
+	mov	pc, r0
+
+/*
+ * cpu_arm946_do_idle()
+ */
+	.align	5
+ENTRY(cpu_arm946_do_idle)
+#if defined(CONFIG_CPU_ARM946_CPU_IDLE)
+	mcr	p15, 0, r0, c7, c0, 4		@ Wait for interrupt
+#endif
+	mov	pc, lr
+
+/* ================================= CACHE ================================ */
+
+
+/*
+ * cpu_arm946_cache_clean_invalidate_all()
+ *
+ * clean and invalidate all cache lines
+ *
+ * Note:
+ *  1. we should preserve r0 at all times
+ */
+	.align	5
+ENTRY(cpu_arm946_cache_clean_invalidate_all)
+	mov	r2, #1
+cpu_arm946_cache_clean_invalidate_all_r2:
+	mov	ip, #0
+#ifdef CONFIG_CPU_ARM946_FORCE_WRITE_THROUGH
+	mcr	p15, 0, ip, c7, c6, 0		@ invalidate D cache
+#else
+/*
+ * 'Clean & Invalidate whole DCache'
+ * Re-written to use Index Ops.
+ * Uses registers r1, r3 and ip
+ */
+	mov	r1, #7 << 5			@ 8 segments
+1:	orr	r3, r1, #63 << 26		@ 64 entries
+2:	mcr	p15, 0, r3, c7, c14, 2		@ clean & invalidate D index
+	subs	r3, r3, #1 << 26
+	bcs	2b				@ entries 63 to 0
+	subs	r1, r1, #1 << 5
+	bcs	1b				@ segments 7 to 0
+#endif
+	teq	r2, #0
+	mcrne	p15, 0, ip, c7, c5, 0		@ invalidate I cache
+	mcr	p15, 0, ip, c7, c10, 4		@ drain WB
+	mov	pc, lr
+
+/*
+ * cpu_arm946_cache_clean_invalidate_range(start, end, flags)
+ *
+ * clean and invalidate all cache lines associated with this area of memory
+ *
+ * start: Area start address
+ * end:   Area end address
+ * flags: nonzero for I cache as well
+ */
+	.align	5
+ENTRY(cpu_arm946_cache_clean_invalidate_range)
+	bic	r0, r0, #DCACHELINESIZE - 1	@ && added by PGM
+	sub	r3, r1, r0
+	cmp	r3, #MAX_AREA_SIZE
+	bgt	cpu_arm946_cache_clean_invalidate_all_r2
+1:	mcr	p15, 0, r0, c7, c14, 1		@ clean and invalidate D entry
+	add	r0, r0, #DCACHELINESIZE
+	mcr	p15, 0, r0, c7, c14, 1		@ clean and invalidate D entry
+	add	r0, r0, #DCACHELINESIZE
+	cmp	r0, r1
+	blt	1b
+	teq	r2, #0
+	movne	r0, #0
+	mcrne	p15, 0, r0, c7, c5, 0		@ invalidate I cache
+	mov	pc, lr
+
+/*
+ * cpu_arm946_flush_ram_page(page)
+ *
+ * clean and invalidate all cache lines associated with this area of memory
+ *
+ * page: page to clean and invalidate
+ */
+	.align	5
+ENTRY(cpu_arm946_flush_ram_page)
+	mov	pc, lr
+	
+
+/* ================================ D-CACHE =============================== */
+
+/*
+ * cpu_arm946_dcache_invalidate_range(start, end)
+ *
+ * throw away all D-cached data in specified region without an obligation
+ * to write them back.  Note however that we must clean the D-cached entries
+ * around the boundaries if the start and/or end address are not cache
+ * aligned.
+ *
+ * start: virtual start address
+ * end:   virtual end address
+ */
+	.align	5
+ENTRY(cpu_arm946_dcache_invalidate_range)
+	tst	r0, #DCACHELINESIZE - 1
+	bic	r0, r0, #DCACHELINESIZE - 1
+	mcrne	p15, 0, r0, c7, c10, 1		@ clean D entry
+	tst	r1, #DCACHELINESIZE - 1
+	mcrne	p15, 0, r1, c7, c10, 1		@ clean D entry
+1:	mcr	p15, 0, r0, c7, c6, 1		@ invalidate D entry
+	add	r0, r0, #DCACHELINESIZE
+	cmp	r0, r1
+	blt	1b
+	mov	pc, lr
+
+/*
+ * cpu_arm946_dcache_clean_range(start, end)
+ *
+ * For the specified virtual address range, ensure that all caches contain
+ * clean data, such that peripheral accesses to the physical RAM fetch
+ * correct data.
+ *
+ * start: virtual start address
+ * end:   virtual end address
+ */
+	.align	5
+ENTRY(cpu_arm946_dcache_clean_range)
+	bic	r0, r0, #DCACHELINESIZE - 1
+	sub	r1, r1, r0
+	cmp	r1, #MAX_AREA_SIZE
+	mov	r2, #0
+	bgt	cpu_arm946_cache_clean_invalidate_all_r2
+
+1:	mcr	p15, 0, r0, c7, c10, 1		@ clean D entry
+	add	r0, r0, #DCACHELINESIZE
+	mcr	p15, 0, r0, c7, c10, 1		@ clean D entry
+	add	r0, r0, #DCACHELINESIZE
+	subs	r1, r1, #2 * DCACHELINESIZE
+	bpl	1b
+	mcr	p15, 0, r2, c7, c10, 4		@ drain WB
+	mov	pc, lr
+
+/*
+ * cpu_arm946_dcache_clean_page(page)
+ *
+ * Cleans a single page of dcache so that if we have any future aliased
+ * mappings, they will be consistent at the time that they are created.
+ *
+ * page: virtual address of page to clean from dcache
+ *
+ * Note:
+ *  1. we don't need to flush the write buffer in this case.
+ *  2. we don't invalidate the entries since when we write the page
+ *     out to disk, the entries may get reloaded into the cache.
+ */
+	.align	5
+ENTRY(cpu_arm946_dcache_clean_page)
+#ifndef CONFIG_CPU_ARM946_FORCE_WRITE_THROUGH
+	mov	r1, #PAGESIZE
+1:	mcr	p15, 0, r0, c7, c10, 1		@ clean D entry
+	add	r0, r0, #DCACHELINESIZE
+	mcr	p15, 0, r0, c7, c10, 1		@ clean D entry
+	add	r0, r0, #DCACHELINESIZE
+	subs	r1, r1, #2 * DCACHELINESIZE
+	bne	1b
+#endif
+	mov	pc, lr
+
+/*
+ * cpu_arm946_dcache_clean_entry(addr)
+ *
+ * Clean the specified entry of any caches such that the MMU
+ * translation fetches will obtain correct data.
+ *
+ * addr: cache-unaligned virtual address
+ */
+	.align	5
+ENTRY(cpu_arm946_dcache_clean_entry)
+#ifndef CONFIG_CPU_ARM946_FORCE_WRITE_THROUGH
+	mcr	p15, 0, r0, c7, c10, 1		@ clean D entry
+#endif
+	mcr	p15, 0, r0, c7, c10, 4		@ drain WB
+	mov	pc, lr
+
+/* ================================ I-CACHE =============================== */
+
+/*
+ * cpu_arm946_icache_invalidate_range(start, end)
+ *
+ * invalidate a range of virtual addresses from the Icache
+ *
+ * start: virtual start address
+ * end:   virtual end address
+ */
+	.align	5
+ENTRY(cpu_arm946_icache_invalidate_range)
+1:	mcr	p15, 0, r0, c7, c10, 1		@ Clean D entry
+	add	r0, r0, #DCACHELINESIZE
+	cmp	r0, r1
+	blo	1b
+	mov	r0, #0
+	mcr	p15, 0, r0, c7, c10, 4		@ drain WB
+ENTRY(cpu_arm946_icache_invalidate_page)
+	mcr	p15, 0, r0, c7, c5, 0		@ invalidate I cache
+	mov	pc, lr
+
+
+/* ================================== TLB ================================= */
+
+/*
+ * cpu_arm946_tlb_invalidate_all()
+ *
+ * Invalidate all TLB entries
+ */
+	.align	5
+ENTRY(cpu_arm946_tlb_invalidate_all)
+	mov	pc, lr
+	
+
+/*
+ * cpu_arm946_tlb_invalidate_range(start, end)
+ *
+ * invalidate TLB entries covering the specified range
+ *
+ * start: range start address
+ * end:   range end address
+ */
+	.align	5
+ENTRY(cpu_arm946_tlb_invalidate_range)
+	mov	pc, lr
+
+/*
+ * cpu_arm946_tlb_invalidate_page(page, flags)
+ *
+ * invalidate the TLB entries for the specified page.
+ *
+ * page:  page to invalidate
+ * flags: non-zero if we include the I TLB
+ */
+	.align	5
+ENTRY(cpu_arm946_tlb_invalidate_page)
+	mov	pc, lr
+
+/* =============================== PageTable ============================== */
+
+/*
+ * cpu_arm946_set_pgd(pgd)
+ *
+ * Set the translation base pointer to be as described by pgd.
+ *
+ * pgd: new page tables
+ */
+	.align	5
+ENTRY(cpu_arm946_set_pgd)
+	mov	pc, lr
+
+/*
+ * cpu_arm946_set_pmd(pmdp, pmd)
+ *
+ * Set a level 1 translation table entry, and clean it out of
+ * any caches such that the MMUs can load it correctly.
+ *
+ * pmdp: pointer to PMD entry
+ * pmd:  PMD value to store
+ */
+	.align	5
+ENTRY(cpu_arm946_set_pmd)
+	mov	pc, lr
+
+/*
+ * cpu_arm946_set_pte(ptep, pte)
+ *
+ * Set a PTE and flush it out
+ */
+	.align	5
+ENTRY(cpu_arm946_set_pte)
+	mov	pc, lr
+
+
+cpu_manu_name:
+	.asciz	"ARM"
+ENTRY(cpu_arm946_name)
+	.ascii	"Arm946"
+#if defined(CONFIG_CPU_ARM946_CPU_IDLE)
+	.ascii	"s"
+#endif
+#if defined(CONFIG_CPU_ARM946_I_CACHE_ON)
+	.ascii	"i"
+#endif
+#if defined(CONFIG_CPU_ARM946_D_CACHE_ON)
+	.ascii	"d"
+#if defined(CONFIG_CPU_ARM946_FORCE_WRITE_THROUGH)
+	.ascii	"(wt)"
+#else
+	.ascii	"(wb)"
+#endif
+#endif
+	.ascii	"\0"
+	.align
+
+	.section ".text.init", #alloc, #execinstr
+
+__arm946_setup:
+	/* initialize memory regions and mpu */
+	mov	r2, lr
+	bl	mpu_regions_set
+	mov	lr, r2
+	MRC     p15, 0, R0, c1, c0, 0		@ get control register
+/*
+ * Clear out 'unwanted' bits (then put them in if we need them)
+ */
+	bic	r0, r0, #0x0e00			@ ....??r.........
+	bic	r0, r0, #0x0002			@ ..............a.
+	bic	r0, r0, #0x000c			@ W,D
+	bic	r0, r0, #0x1000			@ I
+/*
+ * Turn on what we want
+ */
+	orr	r0, r0, #0x0001			@ Enable PU
+
+#ifdef CONFIG_CPU_ARM946_D_CACHE_ON
+	orr	r0, r0, #0x0004			@ Enable D cache
+#endif
+#ifdef CONFIG_CPU_ARM946_I_CACHE_ON
+	orr	r0, r0, #0x1000                 @ I Cache on
+#endif
+	mov	pc, lr
+
+	.text
+.equ	Protection_Unit_Enable,	(1 << 0)
+ENTRY(__Unprotect946)
+	mrc	p15, 0, r3, c1, c0, 0		@ get a copy of the current state of the proc
+	mov	r2,#Protection_Unit_Enable
+	mvn	r2,r2
+	and	r3,r3,r2			@ protection off
+	mcr	p15, 0, r3, c1, c0, 0		@ put it back
+	mov	pc, lr
+ENTRY(__Protect946)
+	mrc	p15, 0, r3, c1, c0, 0		@ get a copy of the current state of the proc
+	mov	r2,#Protection_Unit_Enable
+	orr	r3,r3,r2			@ protection on
+	mcr	p15, 0, r3, c1, c0, 0		@ put it back
+	mov	pc, lr
+
+
+mpu_regions_set:
+
+
+/* initialize MPU:
+ * ----------------------------
+ * region 0 - background for all address space.
+ *	    - 0x0000.0000 - 0xFFFF.FFFF (uncachable, unbufferable)
+ * region 1 - SDRAM, all cachable and bufferable.
+ *	    - 0x0000.0000 - 0x007F.FFFF (cachable, bufferable)
+ *   Next Two regions cover the last 40 KBytes of SDRAM with
+ *   uncachable, unbufferable memory (32KB:[region 2] + 8KB:[region 3])
+ * region 2 - first 32 KBytes.
+ *	    - 0x007F.6000 - 0x007F.E000 (uncachable, unbufferable)
+ * region 3 - last  8 KBytes.
+ *	    - 0x007F.E000 - 0x007F.FFFF (uncachable, unbufferable)
+ */
+
+/* TODO - close this into a nice loop instead of this silly chain */
+	/* Define the regions */
+	adr	r0, REGION0
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c0, 0
+	adr	r0, REGION1
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c1, 0
+	adr	r0, REGION2
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c2, 0
+	adr	r0, REGION3
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c3, 0
+	adr	r0, REGION4
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c4, 0
+	adr	r0, REGION5
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c5, 0
+	adr	r0, REGION6
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c6, 0
+	adr	r0, REGION7
+	ldmia	r0, {r0}
+	mcr	p15, 0, r0, c6, c7, 0
+
+	/* set cachable / non-cacheable */
+	/* move #2 into r0 = binary(00000010), which means only region #1 */
+	mov	r0, #2
+	/* data cache */
+	mcr	p15, 0, r0, c2, c0, 0
+	/* instruction cache */
+	mcr	p15, 0, r0, c2, c0, 1
+
+	/* set bufferable / non-bufferable */
+	mcr	p15, 0, r0, c3, c0, 0
+
+	/* set permissions for all regions */
+	adr	r0, ALL_PERMITED
+	ldmia	r0, {r0}
+	/* data access permissions */
+	mcr	p15, 0, r0, c5, c0, 2
+	/* instructions access permissions */
+	mcr	p15, 0, r0, c5, c0, 3
+
+	/* enable PU */
+	/* read current state, and turn on I+D caches and the PU */
+	mrc	p15, 0, r0, c1, c0, 0
+	/* (ICache | DCache | PU) = (BIT12 | BIT2 | BIT0) */
+	adr	r1, CONTROL_MASK
+	ldmia	r1, {r1}
+	orr	r0, r1, r0
+	mcr	p15, 0, r0, c1, c0, 0
+	mov	pc, lr
+
+REGION0:	.long	0x0000003F
+REGION1:	.long	0xD000002F
+REGION2:	.long	((DRAM_BASE + DRAM_SIZE) | 0x00000023)
+REGION3:	.long	0x0
+REGION4:	.long	0x0
+REGION5:	.long	0x0
+REGION6:	.long	0x0
+REGION7:	.long	0x0
+ALL_PERMITED:	.long   0x33333333
+CONTROL_MASK:	.long   0x00001005
+
+/* End of MPU initialization. */
+
+
+/*
+ * Purpose : Function pointers used to access above functions - all calls
+ *	     come through these
+ */
+	.type	arm946_processor_functions, #object
+arm946_processor_functions:
+	.word	cpu_arm946_data_abort
+	.word	cpu_arm946_check_bugs
+	.word	cpu_arm946_proc_init
+	.word	cpu_arm946_proc_fin
+	.word	cpu_arm946_reset
+	.word   cpu_arm946_do_idle
+
+	/* cache */
+	.word	cpu_arm946_cache_clean_invalidate_all
+	.word	cpu_arm946_cache_clean_invalidate_range
+	.word	cpu_arm946_flush_ram_page
+
+	/* dcache */
+	.word	cpu_arm946_dcache_invalidate_range
+	.word	cpu_arm946_dcache_clean_range
+	.word	cpu_arm946_dcache_clean_page
+	.word	cpu_arm946_dcache_clean_entry
+
+	/* icache */
+	.word	cpu_arm946_icache_invalidate_range
+	.word	cpu_arm946_icache_invalidate_page
+
+	/* tlb */
+	.word	cpu_arm946_tlb_invalidate_all
+	.word	cpu_arm946_tlb_invalidate_range
+	.word	cpu_arm946_tlb_invalidate_page
+
+	/* pgtable */
+	.word	cpu_arm946_set_pgd
+	.word	cpu_arm946_set_pmd
+	.word	cpu_arm946_set_pte
+	.size	arm946_processor_functions, . - arm946_processor_functions
+
+	.type	cpu_arm946_info, #object
+cpu_arm946_info:
+	.long	cpu_manu_name
+	.long	cpu_arm946_name
+	.size	cpu_arm946_info, . - cpu_arm946_info
+
+	.type	cpu_arch_name, #object
+cpu_arch_name:
+	.asciz	"armv4"
+	.size	cpu_arch_name, . - cpu_arch_name
+
+	.type	cpu_elf_name, #object
+cpu_elf_name:
+	.asciz	"v4"
+	.size	cpu_elf_name, . - cpu_elf_name
+	.align
+
+	.section ".proc.info", #alloc, #execinstr
+
+	.type	__arm946_proc_info,#object
+__arm946_proc_info:
+	.long	0x41009460
+	.long	0xff00fff0
+	.long	0x00000c1e			@ mmuflags
+	b	__arm946_setup
+	.long	cpu_arch_name
+	.long	cpu_elf_name
+	.long	HWCAP_SWP | HWCAP_HALF | HWCAP_26BIT
+	.long	cpu_arm946_info
+	.long	arm946_processor_functions
+	.size	__arm946_proc_info, . - __arm946_proc_info
+
+
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/arch/armnommu/tools/mach-types linux-2.4.32-uc0-wl530g/arch/armnommu/tools/mach-types
--- linux-2.4.32-uc0-mtdcvs/arch/armnommu/tools/mach-types	2005-10-06 05:48:36.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/arch/armnommu/tools/mach-types	2006-09-10 12:53:17.000000000 +0300
@@ -99,8 +99,8 @@
 pda1			ARCH_PDA1		PDA1			88
 lubbock			ARCH_LUBBOCK		LUBBOCK			89
 aniko			ARCH_ANIKO		ANIKO			90
-clep7212		ARCH_CLEP7212		CLEP7212		91
-cs89712			ARCH_CS89712		CS89712			92
+clep7212		ARCH_CLEP7212		CLEP7212		9991
+cs89712			ARCH_CS89712		CS89712			9992
 weararm			SA1100_WEARARM		WEARARM			93
 possio_px		SA1100_POSSIO_PX	POSSIO_PX		94
 sidearm			SA1100_SIDEARM		SIDEARM			95
@@ -804,3 +804,5 @@
 smdk2500              BOARD_SMDK2500          SMDK2500                166
 W90N740               ARCH_WINBOND            W90N740                 180
 
+firefox			ARCH_FIREFOX		FIREFOX			91
+libertas		ARCH_LIBERTAS		LIBERTAS		92
diff -bBurN linux-2.4.32-uc0-mtdcvs/.config linux-2.4.32-uc0-wl530g/.config
--- linux-2.4.32-uc0-mtdcvs/.config	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/.config	2006-09-10 14:31:44.000000000 +0300
@@ -0,0 +1,721 @@
+#
+# Automatically generated by make menuconfig: don't edit
+#
+CONFIG_ARM=y
+# CONFIG_SBUS is not set
+CONFIG_UID16=y
+CONFIG_RWSEM_GENERIC_SPINLOCK=y
+CONFIG_UCLINUX=y
+MAGIC_ROM_PTR=y
+
+#
+# Code maturity level options
+#
+# CONFIG_EXPERIMENTAL is not set
+# CONFIG_OBSOLETE is not set
+
+#
+# Loadable module support
+#
+CONFIG_MODULES=y
+# CONFIG_MODVERSIONS is not set
+# CONFIG_KMOD is not set
+
+#
+# System Type
+#
+# CONFIG_ARCH_DSC21 is not set
+# CONFIG_ARCH_VC547X is not set
+# CONFIG_ARCH_DM270 is not set
+# CONFIG_ARCH_CNXT is not set
+# CONFIG_ARCH_NETARM is not set
+# CONFIG_ARCH_TA7S is not set
+# CONFIG_ARCH_TA7V is not set
+# CONFIG_ARCH_SWARM is not set
+# CONFIG_ARCH_INL is not set
+# CONFIG_ARCH_SAMSUNG is not set
+# CONFIG_ARCH_LPC is not set
+# CONFIG_MACH_EB67XDIP is not set
+# CONFIG_ARCH_ATMEL is not set
+# CONFIG_MACH_UC5471DSP is not set
+# CONFIG_MACH_SJ5471ENG is not set
+# CONFIG_ARCH_IPOD is not set
+# CONFIG_ARCH_WINBOND is not set
+# CONFIG_ARCH_FIREFOX is not set
+CONFIG_ARCH_LIBERTAS=y
+# CONFIG_CPU_BIG_ENDIAN is not set
+# CONFIG_LIBERTAS_AP22 is not set
+CONFIG_LIBERTAS_AP32=y
+CONFIG_CMDLINE_BOOL=y
+CONFIG_CMDLINE="console=ttyS0,38400 root=/dev/mtdblock1 ro rootfstype=cramfs"
+# CONFIG_CPU_ARM946_CPU_IDLE is not set
+CONFIG_CPU_ARM946_I_CACHE_ON=y
+CONFIG_CPU_ARM946_D_CACHE_ON=y
+# CONFIG_CPU_ARM946_WRITETHROUGH is not set
+# CONFIG_128MHZ_CLOCK is not set
+CONFIG_160MHZ_CLOCK=y
+# CONFIG_8M_MEM is not set
+CONFIG_16M_MEM=y
+CONFIG_SET_MEM_PARAM=y
+DRAM_BASE=0xd0000000
+DRAM_SIZE=0xfC0000
+FLASH_MEM_BASE=0xffc00000
+FLASH_SIZE=0x400000
+FLASH_ROMFS_BASE=0xffca0000
+FLASH_JFFS2_BASE=0xfff80000
+# CONFIG_RAMKERNEL is not set
+CONFIG_ROMKERNEL=y
+CONFIG_NO_PGT_CACHE=y
+CONFIG_CPU_ARM946=y
+CONFIG_CPU_32=y
+# CONFIG_CPU_26 is not set
+CONFIG_CPU_WITH_CACHE=y
+CONFIG_CPU_WITH_MCR_INSTRUCTION=y
+CONFIG_CMDLINE_BOOL=y
+DRAM_BASE=0xd0000000
+DRAM_SIZE=0xfC0000
+FLASH_MEM_BASE=0xffc00000
+FLASH_SIZE=0x400000
+FLASH_ROMFS_BASE=0xffca0000
+FLASH_JFFS2_BASE=0xfff80000
+
+#
+# General setup
+#
+# CONFIG_HOTPLUG is not set
+# CONFIG_PCMCIA is not set
+CONFIG_NET=y
+# CONFIG_SYSVIPC is not set
+# CONFIG_REDUCED_MEMORY is not set
+# CONFIG_BSD_PROCESS_ACCT is not set
+CONFIG_SYSCTL=y
+# CONFIG_NWFPE is not set
+CONFIG_KCORE_ELF=y
+# CONFIG_KCORE_AOUT is not set
+CONFIG_BINFMT_FLAT=y
+# CONFIG_BINFMT_ZFLAT is not set
+CONFIG_KERNEL_ELF=y
+# CONFIG_ARTHUR is not set
+# CONFIG_ALIGNMENT_TRAP is not set
+# CONFIG_PCI is not set
+# CONFIG_RAM_ATTACHED_ROMFS is not set
+
+#
+# Networking options
+#
+CONFIG_PACKET=y
+# CONFIG_PACKET_MMAP is not set
+# CONFIG_NETLINK_DEV is not set
+CONFIG_NETFILTER=y
+CONFIG_NETFILTER_DEBUG=y
+# CONFIG_FILTER is not set
+# CONFIG_NET_NEIGH_DEBUG is not set
+# CONFIG_NET_RESTRICTED_REUSE is not set
+CONFIG_UNIX=y
+CONFIG_INET=y
+# CONFIG_IP_MULTICAST is not set
+# CONFIG_IP_ADVANCED_ROUTER is not set
+# CONFIG_IP_PNP is not set
+# CONFIG_NET_ARP_LIMIT is not set
+# CONFIG_NET_IPIP is not set
+# CONFIG_NET_IPGRE is not set
+# CONFIG_INET_ECN is not set
+# CONFIG_SYN_COOKIES is not set
+
+#
+#   IP: Netfilter Configuration
+#
+CONFIG_IP_NF_CONNTRACK=y
+CONFIG_IP_NF_FTP=y
+# CONFIG_IP_NF_CONNTRACK_MARK is not set
+CONFIG_IP_NF_H323=y
+# CONFIG_IP_NF_AMANDA is not set
+CONFIG_IP_NF_TFTP=y
+# CONFIG_IP_NF_IRC is not set
+CONFIG_IP_NF_CT_PROTO_GRE=m
+CONFIG_IP_NF_PPTP=m
+# CONFIG_IP_NF_PPTP_DEBUG is not set
+# CONFIG_IP_NF_CT_ACCT is not set
+# CONFIG_IP_NF_CONNTRACK_EVENTS is not set
+CONFIG_IP_NF_IPTABLES=y
+# CONFIG_IP_NF_MATCH_LIMIT is not set
+# CONFIG_IP_NF_MATCH_IPRANGE is not set
+CONFIG_IP_NF_MATCH_MAC=y
+# CONFIG_IP_NF_MATCH_PKTTYPE is not set
+CONFIG_IP_NF_MATCH_MARK=y
+# CONFIG_IP_NF_MATCH_MULTIPORT is not set
+# CONFIG_IP_NF_MATCH_TOS is not set
+CONFIG_IP_NF_MATCH_TIME=y
+# CONFIG_IP_NF_MATCH_RECENT is not set
+# CONFIG_IP_NF_MATCH_ECN is not set
+# CONFIG_IP_NF_MATCH_DSCP is not set
+# CONFIG_IP_NF_MATCH_AH_ESP is not set
+# CONFIG_IP_NF_MATCH_LENGTH is not set
+# CONFIG_IP_NF_MATCH_TTL is not set
+CONFIG_IP_NF_MATCH_TCPMSS=y
+# CONFIG_IP_NF_MATCH_HELPER is not set
+CONFIG_IP_NF_MATCH_STATE=y
+# CONFIG_IP_NF_MATCH_CONNTRACK is not set
+# CONFIG_IP_NF_MATCH_PHYSDEV is not set
+CONFIG_IP_NF_FILTER=y
+CONFIG_IP_NF_TARGET_REJECT=y
+# CONFIG_IP_NF_BIG_CONNTRACK is not set
+CONFIG_IP_NF_NAT=y
+CONFIG_IP_NF_NAT_NEEDED=y
+CONFIG_IP_NF_TARGET_MASQUERADE=y
+CONFIG_IP_NF_TARGET_REDIRECT=y
+# CONFIG_IP_NF_TARGET_NETMAP is not set
+CONFIG_IP_NF_NAT_H323=y
+CONFIG_IP_NF_NAT_FTP=y
+CONFIG_IP_NF_NAT_PPTP=m
+CONFIG_IP_NF_NAT_PROTO_GRE=m
+CONFIG_IP_NF_NAT_TFTP=y
+CONFIG_IP_NF_MANGLE=y
+# CONFIG_IP_NF_TARGET_TOS is not set
+# CONFIG_IP_NF_TARGET_ECN is not set
+# CONFIG_IP_NF_TARGET_DSCP is not set
+CONFIG_IP_NF_TARGET_MARK=y
+# CONFIG_IP_NF_TARGET_IMQ is not set
+CONFIG_IP_NF_TARGET_LOG=y
+# CONFIG_IP_NF_TARGET_CONNLOG is not set
+# CONFIG_IP_NF_TARGET_ULOG is not set
+CONFIG_IP_NF_TARGET_TCPMSS=y
+# CONFIG_IP_NF_ARPTABLES is not set
+
+#
+#   IP: Virtual Server Configuration
+#
+# CONFIG_IP_VS is not set
+# CONFIG_VLAN_8021Q is not set
+# CONFIG_IPX is not set
+# CONFIG_ATALK is not set
+# CONFIG_DECNET is not set
+CONFIG_BRIDGE=y
+# CONFIG_BRIDGE_NF_EBTABLES is not set
+# CONFIG_BRIDGE_EBT_T_FILTER is not set
+# CONFIG_BRIDGE_EBT_T_NAT is not set
+# CONFIG_BRIDGE_EBT_BROUTE is not set
+# CONFIG_BRIDGE_EBT_LOG is not set
+# CONFIG_BRIDGE_EBT_IPF is not set
+# CONFIG_BRIDGE_EBT_ARPF is not set
+# CONFIG_BRIDGE_EBT_AMONG is not set
+# CONFIG_BRIDGE_EBT_LIMIT is not set
+# CONFIG_BRIDGE_EBT_VLANF is not set
+# CONFIG_BRIDGE_EBT_802_3 is not set
+# CONFIG_BRIDGE_EBT_PKTTYPE is not set
+# CONFIG_BRIDGE_EBT_STP is not set
+# CONFIG_BRIDGE_EBT_MARKF is not set
+# CONFIG_BRIDGE_EBT_ARPREPLY is not set
+# CONFIG_BRIDGE_EBT_SNAT is not set
+# CONFIG_BRIDGE_EBT_DNAT is not set
+# CONFIG_BRIDGE_EBT_REDIRECT is not set
+# CONFIG_BRIDGE_EBT_MARK_T is not set
+
+#
+# QoS and/or fair queueing
+#
+# CONFIG_NET_SCHED is not set
+# CONFIG_IPSEC is not set
+# CONFIG_KLIPS is not set
+
+#
+# Network testing
+#
+# CONFIG_NET_PKTGEN is not set
+# CONFIG_IPSEC_NAT_TRAVERSAL is not set
+
+#
+# Network device support
+#
+CONFIG_NETDEVICES=y
+
+#
+# ARCnet devices
+#
+# CONFIG_ARCNET is not set
+# CONFIG_DUMMY is not set
+# CONFIG_BONDING is not set
+# CONFIG_EQUALIZER is not set
+# CONFIG_IMQ is not set
+# CONFIG_TUN is not set
+
+#
+# Ethernet (10 or 100Mbit)
+#
+CONFIG_NET_ETHERNET=y
+# CONFIG_ARM_AM79C961A is not set
+# CONFIG_ARM_CIRRUS is not set
+# CONFIG_SUNLANCE is not set
+# CONFIG_SUNBMAC is not set
+# CONFIG_SUNQE is not set
+# CONFIG_SUNGEM is not set
+# CONFIG_NET_VENDOR_3COM is not set
+# CONFIG_LANCE is not set
+# CONFIG_NET_VENDOR_SMC is not set
+# CONFIG_NET_VENDOR_RACAL is not set
+# CONFIG_NET_ISA is not set
+# CONFIG_NET_PCI is not set
+# CONFIG_NET_POCKET is not set
+# CONFIG_CNXT_EMAC is not set
+# CONFIG_FEC is not set
+# CONFIG_CS89x0 is not set
+# CONFIG_UCCS8900 is not set
+# CONFIG_AX88796 is not set
+# CONFIG_DM9000 is not set
+
+#
+# Ethernet (1000 Mbit)
+#
+# CONFIG_ACENIC is not set
+# CONFIG_DL2K is not set
+# CONFIG_E1000 is not set
+# CONFIG_MYRI_SBUS is not set
+# CONFIG_NS83820 is not set
+# CONFIG_HAMACHI is not set
+# CONFIG_YELLOWFIN is not set
+# CONFIG_R8169 is not set
+# CONFIG_SK98LIN is not set
+# CONFIG_TIGON3 is not set
+# CONFIG_FDDI is not set
+# CONFIG_PLIP is not set
+CONFIG_PPP=y
+# CONFIG_PPP_MULTILINK is not set
+# CONFIG_PPP_FILTER is not set
+CONFIG_PPP_ASYNC=y
+CONFIG_PPP_SYNC_TTY=y
+CONFIG_PPP_DEFLATE=y
+CONFIG_PPP_BSDCOMP=y
+# CONFIG_SLIP is not set
+
+#
+# Wireless LAN (non-hamradio)
+#
+CONFIG_NET_RADIO=y
+# CONFIG_STRIP is not set
+# CONFIG_WAVELAN is not set
+# CONFIG_ARLAN is not set
+# CONFIG_AIRONET4500 is not set
+# CONFIG_AIRONET4500_NONCS is not set
+# CONFIG_AIRONET4500_PROC is not set
+# CONFIG_HERMES is not set
+# CONFIG_PRISM54 is not set
+# CONFIG_NET_WIRELESS is not set
+
+#
+# Token Ring devices
+#
+# CONFIG_TR is not set
+# CONFIG_NET_FC is not set
+
+#
+# Wan interfaces
+#
+# CONFIG_WAN is not set
+
+#
+# Amateur Radio support
+#
+# CONFIG_HAMRADIO is not set
+
+#
+# IrDA (infrared) support
+#
+# CONFIG_IRDA is not set
+
+#
+# ATA/IDE/MFM/RLL support
+#
+# CONFIG_IDE is not set
+# CONFIG_BLK_DEV_HD is not set
+
+#
+# SCSI support
+#
+# CONFIG_SCSI is not set
+
+#
+# ISDN subsystem
+#
+# CONFIG_ISDN is not set
+
+#
+# Parallel port support
+#
+# CONFIG_PARPORT is not set
+
+#
+# Memory Technology Devices (MTD)
+#
+CONFIG_MTD=y
+# CONFIG_MTD_DEBUG is not set
+CONFIG_MTD_PARTITIONS=y
+# CONFIG_MTD_CONCAT is not set
+# CONFIG_MTD_REDBOOT_PARTS is not set
+# CONFIG_MTD_CMDLINE_PARTS is not set
+# CONFIG_MTD_AFS_PARTS is not set
+CONFIG_MTD_CHAR=y
+CONFIG_MTD_BLOCK=y
+# CONFIG_FTL is not set
+# CONFIG_NFTL is not set
+# CONFIG_INFTL is not set
+
+#
+# RAM/ROM/Flash chip drivers
+#
+CONFIG_MTD_CFI=y
+# CONFIG_MTD_JEDECPROBE is not set
+CONFIG_MTD_GEN_PROBE=y
+CONFIG_MTD_CFI_ADV_OPTIONS=y
+CONFIG_MTD_CFI_NOSWAP=y
+# CONFIG_MTD_CFI_BE_BYTE_SWAP is not set
+# CONFIG_MTD_CFI_LE_BYTE_SWAP is not set
+CONFIG_MTD_CFI_GEOMETRY=y
+CONFIG_MTD_MAP_BANK_WIDTH_1=y
+# CONFIG_MTD_MAP_BANK_WIDTH_2 is not set
+# CONFIG_MTD_MAP_BANK_WIDTH_4 is not set
+# CONFIG_MTD_MAP_BANK_WIDTH_8 is not set
+# CONFIG_MTD_MAP_BANK_WIDTH_16 is not set
+# CONFIG_MTD_MAP_BANK_WIDTH_32 is not set
+CONFIG_MTD_CFI_I1=y
+# CONFIG_MTD_CFI_I2 is not set
+# CONFIG_MTD_CFI_I4 is not set
+# CONFIG_MTD_CFI_I8 is not set
+CONFIG_MTD_CFI_INTELEXT=y
+CONFIG_MTD_CFI_AMDSTD=y
+# CONFIG_MTD_CFI_STAA is not set
+CONFIG_MTD_CFI_UTIL=y
+# CONFIG_MTD_RAM is not set
+# CONFIG_MTD_ROM is not set
+# CONFIG_MTD_ABSENT is not set
+# CONFIG_MTD_OBSOLETE_CHIPS is not set
+# CONFIG_MTD_AMDSTD is not set
+# CONFIG_MTD_SHARP is not set
+# CONFIG_MTD_JEDEC is not set
+
+#
+# Mapping drivers for chip access
+#
+# CONFIG_MTD_COMPLEX_MAPPINGS is not set
+# CONFIG_MTD_PHYSMAP is not set
+CONFIG_MTD_LIBERTAS=y
+# CONFIG_MTD_ARM_INTEGRATOR is not set
+# CONFIG_MTD_CDB89712 is not set
+# CONFIG_MTD_SA1100 is not set
+# CONFIG_MTD_DC21285 is not set
+# CONFIG_MTD_IQ80310 is not set
+# CONFIG_MTD_LUBBOCK is not set
+# CONFIG_MTD_IXP425 is not set
+# CONFIG_MTD_EPXA10DB is not set
+# CONFIG_MTD_FORTUNET is not set
+# CONFIG_MTD_AUTCPU12 is not set
+# CONFIG_MTD_EDB7312 is not set
+# CONFIG_MTD_H720X is not set
+# CONFIG_MTD_IMPA7 is not set
+# CONFIG_MTD_CEIVA is not set
+# CONFIG_MTD_NOR_TOTO is not set
+# CONFIG_MTD_UCLINUX is not set
+# CONFIG_MTD_PCI is not set
+# CONFIG_MTD_PCMCIA is not set
+
+#
+# Self-contained MTD device drivers
+#
+# CONFIG_MTD_PMC551 is not set
+# CONFIG_MTD_SLRAM is not set
+# CONFIG_MTD_MTDRAM is not set
+# CONFIG_MTD_BLKMTD is not set
+# CONFIG_MTD_DOC2000 is not set
+# CONFIG_MTD_DOC2001 is not set
+# CONFIG_MTD_DOC2001PLUS is not set
+# CONFIG_MTD_DOCPROBE is not set
+# CONFIG_MTD_DOCECC is not set
+
+#
+# NAND Flash Device Drivers
+#
+# CONFIG_MTD_NAND is not set
+# CONFIG_MTD_NAND_SPIA is not set
+# CONFIG_MTD_NAND_TOTO is not set
+# CONFIG_MTD_NAND_AUTCPU12 is not set
+# CONFIG_MTD_NAND_EDB7312 is not set
+# CONFIG_MTD_NAND_DISKONCHIP is not set
+
+#
+# Plug and Play configuration
+#
+# CONFIG_PNP is not set
+# CONFIG_ISAPNP is not set
+
+#
+# Block devices
+#
+# CONFIG_BLK_DEV_FD is not set
+# CONFIG_BLK_DEV_XD is not set
+# CONFIG_PARIDE is not set
+# CONFIG_BLK_CPQ_DA is not set
+# CONFIG_BLK_CPQ_CISS_DA is not set
+# CONFIG_CISS_SCSI_TAPE is not set
+# CONFIG_CISS_MONITOR_THREAD is not set
+# CONFIG_BLK_DEV_DAC960 is not set
+# CONFIG_BLK_DEV_UMEM is not set
+# CONFIG_BLK_DEV_SX8 is not set
+# CONFIG_BLK_DEV_LOOP is not set
+# CONFIG_BLK_DEV_NBD is not set
+CONFIG_BLK_DEV_RAM=y
+CONFIG_BLK_DEV_RAM_SIZE=2048
+# CONFIG_BLK_DEV_INITRD is not set
+# CONFIG_BLK_DEV_RAMDISK_DATA is not set
+# CONFIG_BLK_DEV_BLKMEM is not set
+# CONFIG_BLK_STATS is not set
+
+#
+# File systems
+#
+# CONFIG_QUOTA is not set
+# CONFIG_QFMT_V2 is not set
+# CONFIG_AUTOFS_FS is not set
+# CONFIG_AUTOFS4_FS is not set
+# CONFIG_REISERFS_FS is not set
+# CONFIG_REISERFS_CHECK is not set
+# CONFIG_REISERFS_PROC_INFO is not set
+# CONFIG_ADFS_FS is not set
+# CONFIG_ADFS_FS_RW is not set
+# CONFIG_AFFS_FS is not set
+# CONFIG_HFS_FS is not set
+# CONFIG_HFSPLUS_FS is not set
+# CONFIG_BEFS_FS is not set
+# CONFIG_BEFS_DEBUG is not set
+# CONFIG_BFS_FS is not set
+# CONFIG_EXT3_FS is not set
+# CONFIG_JBD is not set
+# CONFIG_JBD_DEBUG is not set
+# CONFIG_FAT_FS is not set
+# CONFIG_MSDOS_FS is not set
+# CONFIG_UMSDOS_FS is not set
+# CONFIG_VFAT_FS is not set
+# CONFIG_EFS_FS is not set
+# CONFIG_JFFS_FS is not set
+# CONFIG_JFFS2_FS is not set
+CONFIG_CRAMFS=y
+# CONFIG_SQUASHFS is not set
+# CONFIG_TMPFS is not set
+CONFIG_RAMFS=y
+# CONFIG_ISO9660_FS is not set
+# CONFIG_JOLIET is not set
+# CONFIG_ZISOFS is not set
+# CONFIG_JFS_FS is not set
+# CONFIG_JFS_DEBUG is not set
+# CONFIG_JFS_STATISTICS is not set
+# CONFIG_MINIX_FS is not set
+# CONFIG_VXFS_FS is not set
+# CONFIG_NTFS_FS is not set
+# CONFIG_NTFS_RW is not set
+# CONFIG_HPFS_FS is not set
+CONFIG_PROC_FS=y
+CONFIG_PROC_NDYNAMIC=4096
+# CONFIG_DEVFS_FS is not set
+# CONFIG_DEVFS_MOUNT is not set
+# CONFIG_DEVFS_DEBUG is not set
+# CONFIG_DEVPTS_FS is not set
+# CONFIG_QNX4FS_FS is not set
+# CONFIG_QNX4FS_RW is not set
+# CONFIG_ROMFS_FS is not set
+# CONFIG_EXT2_FS is not set
+# CONFIG_SYSV_FS is not set
+# CONFIG_UDF_FS is not set
+# CONFIG_UDF_RW is not set
+# CONFIG_UFS_FS is not set
+# CONFIG_UFS_FS_WRITE is not set
+# CONFIG_XFS_FS is not set
+# CONFIG_XFS_QUOTA is not set
+# CONFIG_XFS_RT is not set
+# CONFIG_XFS_TRACE is not set
+# CONFIG_XFS_DEBUG is not set
+
+#
+# Network File Systems
+#
+# CONFIG_CODA_FS is not set
+# CONFIG_INTERMEZZO_FS is not set
+# CONFIG_NFS_FS is not set
+# CONFIG_NFS_V3 is not set
+# CONFIG_NFS_DIRECTIO is not set
+# CONFIG_ROOT_NFS is not set
+# CONFIG_NFSD is not set
+# CONFIG_NFSD_V3 is not set
+# CONFIG_NFSD_TCP is not set
+# CONFIG_SUNRPC is not set
+# CONFIG_LOCKD is not set
+# CONFIG_SMB_FS is not set
+# CONFIG_NCP_FS is not set
+# CONFIG_NCPFS_PACKET_SIGNING is not set
+# CONFIG_NCPFS_IOCTL_LOCKING is not set
+# CONFIG_NCPFS_STRONG is not set
+# CONFIG_NCPFS_NFS_NS is not set
+# CONFIG_NCPFS_OS2_NS is not set
+# CONFIG_NCPFS_SMALLDOS is not set
+# CONFIG_NCPFS_NLS is not set
+# CONFIG_NCPFS_EXTRAS is not set
+# CONFIG_ZISOFS_FS is not set
+# CONFIG_COREDUMP_PRINTK is not set
+
+#
+# Partition Types
+#
+# CONFIG_PARTITION_ADVANCED is not set
+# CONFIG_SMB_NLS is not set
+# CONFIG_NLS is not set
+
+#
+# Input core support
+#
+# CONFIG_INPUT is not set
+# CONFIG_INPUT_KEYBDEV is not set
+# CONFIG_INPUT_MOUSEDEV is not set
+# CONFIG_INPUT_JOYDEV is not set
+# CONFIG_INPUT_EVDEV is not set
+# CONFIG_INPUT_UINPUT is not set
+
+#
+# Character devices
+#
+# CONFIG_LEDMAN is not set
+# CONFIG_SNAPDOG is not set
+# CONFIG_FAST_TIMER is not set
+# CONFIG_DS1302 is not set
+# CONFIG_M41T11M6 is not set
+# CONFIG_VT is not set
+CONFIG_SERIAL=y
+CONFIG_SERIAL_CONSOLE=y
+# CONFIG_SERIAL_EXTENDED is not set
+# CONFIG_SERIAL_NONSTANDARD is not set
+
+#
+# Serial drivers
+#
+# CONFIG_SERIAL_ANAKIN is not set
+# CONFIG_SERIAL_ANAKIN_CONSOLE is not set
+# CONFIG_SERIAL_AMBA is not set
+# CONFIG_SERIAL_AMBA_CONSOLE is not set
+# CONFIG_SERIAL_CLPS711X is not set
+# CONFIG_SERIAL_CLPS711X_CONSOLE is not set
+# CONFIG_SERIAL_21285 is not set
+# CONFIG_SERIAL_21285_OLD is not set
+# CONFIG_SERIAL_21285_CONSOLE is not set
+# CONFIG_SERIAL_UART00 is not set
+# CONFIG_SERIAL_UART00_CONSOLE is not set
+# CONFIG_SERIAL_SA1100 is not set
+# CONFIG_SERIAL_SA1100_CONSOLE is not set
+# CONFIG_SERIAL_OMAHA is not set
+# CONFIG_SERIAL_OMAHA_CONSOLE is not set
+# CONFIG_SERIAL_AT91 is not set
+# CONFIG_SERIAL_AT91_CONSOLE is not set
+# CONFIG_SERIAL_8250 is not set
+# CONFIG_SERIAL_8250_CONSOLE is not set
+# CONFIG_SERIAL_8250_EXTENDED is not set
+# CONFIG_SERIAL_8250_MANY_PORTS is not set
+# CONFIG_SERIAL_8250_SHARE_IRQ is not set
+# CONFIG_SERIAL_8250_DETECT_IRQ is not set
+# CONFIG_SERIAL_8250_MULTIPORT is not set
+# CONFIG_SERIAL_8250_HUB6 is not set
+CONFIG_UNIX98_PTYS=y
+CONFIG_UNIX98_PTY_COUNT=256
+
+#
+# SPI support
+#
+# CONFIG_SPI is not set
+
+#
+# I2C support
+#
+# CONFIG_I2C is not set
+
+#
+# Mice
+#
+# CONFIG_BUSMOUSE is not set
+# CONFIG_MOUSE is not set
+# CONFIG_EDB7312_TS is not set
+
+#
+# Joysticks
+#
+# CONFIG_INPUT_GAMEPORT is not set
+# CONFIG_QIC02_TAPE is not set
+# CONFIG_IPMI_HANDLER is not set
+# CONFIG_IPMI_PANIC_EVENT is not set
+# CONFIG_IPMI_DEVICE_INTERFACE is not set
+# CONFIG_IPMI_KCS is not set
+# CONFIG_IPMI_WATCHDOG is not set
+
+#
+# Controller Area Network Cards/Chips
+#
+# CONFIG_CAN4LINUX is not set
+
+#
+# Watchdog Cards
+#
+# CONFIG_WATCHDOG is not set
+# CONFIG_SCx200 is not set
+# CONFIG_SCx200_GPIO is not set
+# CONFIG_AMD_PM768 is not set
+# CONFIG_NVRAM is not set
+# CONFIG_RTC is not set
+# CONFIG_DTLK is not set
+# CONFIG_R3964 is not set
+# CONFIG_APPLICOM is not set
+
+#
+# Ftape, the floppy tape device driver
+#
+# CONFIG_FTAPE is not set
+# CONFIG_AGP is not set
+
+#
+# Direct Rendering Manager (XFree86 DRI support)
+#
+# CONFIG_DRM is not set
+
+#
+# USB support
+#
+# CONFIG_USB is not set
+
+#
+# Support for USB gadgets
+#
+# CONFIG_USB_GADGET is not set
+
+#
+# I2O device support
+#
+# CONFIG_I2O is not set
+# CONFIG_I2O_BLOCK is not set
+# CONFIG_I2O_LAN is not set
+# CONFIG_I2O_SCSI is not set
+# CONFIG_I2O_PROC is not set
+
+#
+# Kernel hacking
+#
+CONFIG_FRAME_POINTER=y
+# CONFIG_REVISIT is not set
+# CONFIG_DEBUG_ERRORS is not set
+# CONFIG_DEBUG_USER is not set
+# CONFIG_DEBUG_INFO is not set
+# CONFIG_MAGIC_SYSRQ is not set
+
+#
+# Cryptographic options
+#
+# CONFIG_CRYPTO is not set
+
+#
+# Library routines
+#
+# CONFIG_CRC32 is not set
+CONFIG_ZLIB_INFLATE=y
+CONFIG_ZLIB_DEFLATE=y
+# CONFIG_REED_SOLOMON is not set
diff -bBurN linux-2.4.32-uc0-mtdcvs/drivers/block/blkmem.c linux-2.4.32-uc0-wl530g/drivers/block/blkmem.c
--- linux-2.4.32-uc0-mtdcvs/drivers/block/blkmem.c	2005-10-06 08:15:18.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/drivers/block/blkmem.c	2006-09-10 12:49:22.000000000 +0300
@@ -104,6 +104,10 @@
 #include <asm/blkmem.h>
 #endif
 
+#if defined(CONFIG_ARCH_FIREFOX) || defined(CONFIG_ARCH_LIBERTAS)
+#define FIXED_ROMARRAY FLASH_ROMFS_BASE
+#endif
+
 #ifdef CONFIG_MICROBLAZE
 #include <asm/blkmem.h>
 #endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/drivers/mtd/chips/cfi_cmdset_0001.c linux-2.4.32-uc0-wl530g/drivers/mtd/chips/cfi_cmdset_0001.c
--- linux-2.4.32-uc0-mtdcvs/drivers/mtd/chips/cfi_cmdset_0001.c	2006-09-10 13:05:05.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/drivers/mtd/chips/cfi_cmdset_0001.c	2006-09-10 13:22:32.000000000 +0300
@@ -34,6 +34,7 @@
 #include <linux/mtd/mtd.h>
 #include <linux/mtd/compatmac.h>
 #include <linux/mtd/cfi.h>
+#include <linux/bitops.h>
 
 /* #define CMDSET0001_DISABLE_ERASE_SUSPEND_ON_WRITE */
 /* #define CMDSET0001_DISABLE_WRITE_SUSPEND */
diff -bBurN linux-2.4.32-uc0-mtdcvs/drivers/mtd/maps/Config.in linux-2.4.32-uc0-wl530g/drivers/mtd/maps/Config.in
--- linux-2.4.32-uc0-mtdcvs/drivers/mtd/maps/Config.in	2006-09-10 13:05:05.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/drivers/mtd/maps/Config.in	2006-09-10 13:26:54.000000000 +0300
@@ -19,6 +19,8 @@
    dep_tristate '  Sun Microsystems userflash support' CONFIG_MTD_SUN_UFLASH $CONFIG_MTD_CFI
 fi
 
+bool '  CFI Flash device on the Marvell Libertas AP32 board' CONFIG_MTD_LIBERTAS $CONFIG_MTD_CFI $CONFIG_MTD_PARTITIONS
+
 if [ "$CONFIG_X86" = "y" ]; then
    dep_tristate '  CFI Flash device mapped on Photron PNC-2000' CONFIG_MTD_PNC2000 $CONFIG_MTD_CFI $CONFIG_MTD_PARTITIONS
    dep_tristate '  CFI Flash device mapped on AMD SC520 CDP' CONFIG_MTD_SC520CDP $CONFIG_MTD_CFI
diff -bBurN linux-2.4.32-uc0-mtdcvs/drivers/mtd/maps/libertas.c linux-2.4.32-uc0-wl530g/drivers/mtd/maps/libertas.c
--- linux-2.4.32-uc0-mtdcvs/drivers/mtd/maps/libertas.c	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/drivers/mtd/maps/libertas.c	2006-09-10 13:12:33.000000000 +0300
@@ -0,0 +1,177 @@
+/*
+ *	libertas.c - mapper for Marvell Libertas AP-32 board.
+ *
+ * Copyright (C) 2003 - 2005 Marvell Co.
+ *
+ * This code is GPL
+ *
+ */
+
+#include <linux/config.h>
+#include <linux/module.h>
+#include <linux/types.h>
+#include <linux/kernel.h>
+#include <linux/string.h>
+#include <linux/init.h>
+
+#include <linux/mtd/mtd.h>
+#include <linux/mtd/map.h>
+#include <linux/mtd/partitions.h>
+
+#include <linux/fs.h>
+
+#include <asm/io.h>
+
+
+#define NAME         "Marvell Libertas AP-32"
+#define WINDOW_ADDR  0xFFC00000
+#define WINDOW_SIZE  0x00400000
+#define BUSWIDTH     2
+#define SUCCESS      0
+
+
+static struct mtd_info *get_mtd_named(char *name);
+
+
+/* 
+ * MAP DRIVER STUFF
+ */
+
+struct map_info libertas_map = {
+	name: NAME,
+	size: WINDOW_SIZE,
+	bankwidth: BUSWIDTH,
+	phys: WINDOW_ADDR
+};
+
+
+/*
+ * MTD 'PARTITIONING' STUFF 
+ */
+ 
+static struct mtd_partition libertas_partitions[] = {
+	{
+		name: "Libertas AP-32 compressed kernel",
+#ifdef PROTECTION
+		size:   0x000A0000,
+		offset: 0x00000000,
+		mask_flags: MTD_WRITEABLE
+#else
+		size:   0x00380000,
+		offset: 0x00000000
+#endif
+
+	},
+	{
+		name: "Libertas AP-32 romfs root file system",
+#ifdef PROTECTION
+		size:   0x002E0000,
+		offset: 0x000A0000,
+		mask_flags: MTD_WRITEABLE
+#else
+		size:   0x002E0000,
+		offset: 0x000A0000
+#endif
+	},
+	{
+		name: "Libertas AP-32 jffs2 file system",
+		size:   0x00050000,
+		offset: 0x00380000,
+	},
+	{
+		name: "Libertas AP-32 manufacture data",
+		size:   0x00010000,
+		offset: 0x003D0000,
+	}
+};
+
+
+#define PARTITION_NUMBER  (sizeof(libertas_partitions)/sizeof(struct mtd_partition))
+
+/* 
+ * This is the master MTD device for which all the others are just
+ * auto-relocating aliases.
+ */
+ 
+static struct mtd_info *mymtd;
+
+int __init init_libertas(void)
+{
+	struct mtd_info *mtd;
+	int             ret_val;
+	
+	printk(KERN_NOTICE "Marvell Libertas AP-32 flash mapping: %x at %x\n", WINDOW_SIZE, WINDOW_ADDR);
+
+	libertas_map.virt = (unsigned long) ioremap(WINDOW_ADDR, WINDOW_SIZE);
+
+	if (!libertas_map.virt) {
+		printk("%s: failed to ioremap 0x%x\n", NAME, WINDOW_ADDR);
+		return -EIO;
+	}
+
+	simple_map_init(&libertas_map);
+
+	mymtd = do_map_probe("cfi_probe", &libertas_map);
+
+	if (!mymtd) 
+		return -ENXIO;
+
+	mymtd->owner = THIS_MODULE;
+
+	ret_val = add_mtd_partitions(mymtd, libertas_partitions, PARTITION_NUMBER);
+
+	if (ret_val != SUCCESS)
+		return ret_val;
+
+	mtd = get_mtd_named("Libertas AP-32 romfs root file system");
+	
+	if (mtd) {
+		ROOT_DEV = MKDEV(MTD_BLOCK_MAJOR, mtd->index);
+		put_mtd_device(mtd);
+		ret_val = SUCCESS;
+	} else {
+		printk("Can not find root partition and assign ROOT_DEV\n");
+		ret_val = -ENODEV;
+	}
+
+	return ret_val;
+}
+
+static void __exit cleanup_libertas(void)
+{
+	if (mymtd) {
+		del_mtd_partitions(mymtd);
+		map_destroy(mymtd);
+	}
+}
+
+
+/*
+ * Find the MTD device with the given name
+ */
+
+static struct mtd_info *get_mtd_named(char *name)
+{
+	int i;
+	struct mtd_info *mtd;
+
+	for (i = 0; i < MAX_MTD_DEVICES; i++) {
+		mtd = get_mtd_device(NULL, i);
+		if (mtd) {
+			if (strcmp(mtd->name, name) == 0)
+				return(mtd);
+			put_mtd_device(mtd);
+		}
+	}
+	
+	return(NULL);
+}
+
+
+module_init(init_libertas);
+module_exit(cleanup_libertas);
+
+
+MODULE_LICENSE("GPL");
+MODULE_AUTHOR("Marvell Co.");
+MODULE_DESCRIPTION("MTD map driver for Marvell Libertas AP-32 board");
diff -bBurN linux-2.4.32-uc0-mtdcvs/drivers/mtd/maps/Makefile.common linux-2.4.32-uc0-wl530g/drivers/mtd/maps/Makefile.common
--- linux-2.4.32-uc0-mtdcvs/drivers/mtd/maps/Makefile.common	2006-09-10 13:05:05.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/drivers/mtd/maps/Makefile.common	2006-09-10 14:02:54.000000000 +0300
@@ -8,6 +8,7 @@
 endif
 
 # Chip mappings
+obj-$(CONFIG_MTD_LIBERTAS)	+= libertas.o
 obj-$(CONFIG_MTD_CDB89712)	+= cdb89712.o
 obj-$(CONFIG_MTD_ARM_INTEGRATOR)+= integrator-flash.o
 obj-$(CONFIG_MTD_BAST)		+= bast-flash.o
diff -bBurN linux-2.4.32-uc0-mtdcvs/drivers/net/Makefile linux-2.4.32-uc0-wl530g/drivers/net/Makefile
--- linux-2.4.32-uc0-mtdcvs/drivers/net/Makefile	2005-09-02 08:22:22.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/drivers/net/Makefile	2006-09-10 12:49:22.000000000 +0300
@@ -241,6 +241,8 @@
 obj-$(CONFIG_LASI_82596) += lasi_82596.o
 obj-$(CONFIG_MVME16x_NET) += 82596.o
 obj-$(CONFIG_BVME6000_NET) += 82596.o
+obj-$(CONFIG_ARCH_FIREFOX) += mii.o
+obj-$(CONFIG_ARCH_LIBERTAS) += mii.o
 
 # This is also a 82596 and should probably be merged
 obj-$(CONFIG_LP486E) += lp486e.o
diff -bBurN linux-2.4.32-uc0-mtdcvs/fs/jffs2/rbtree.c linux-2.4.32-uc0-wl530g/fs/jffs2/rbtree.c
--- linux-2.4.32-uc0-mtdcvs/fs/jffs2/rbtree.c	2006-09-10 13:05:06.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/fs/jffs2/rbtree.c	2006-09-10 13:16:18.000000000 +0300
@@ -302,44 +302,6 @@
 }
 #endif /* Before 2.4.11 */
 
-	/* These routines haven't made it into 2.4 (yet) */
-struct rb_node *rb_next(struct rb_node *node)
-{
-	/* If we have a right-hand child, go down and then left as far
-	   as we can. */
-	if (node->rb_right) {
-		node = node->rb_right; 
-		while (node->rb_left)
-			node=node->rb_left;
-		return node;
-	}
-
-	/* No right-hand children.  Everything down and left is
-	   smaller than us, so any 'next' node must be in the general
-	   direction of our parent. Go up the tree; any time the
-	   ancestor is a right-hand child of its parent, keep going
-	   up. First time it's a left-hand child of its parent, said
-	   parent is our 'next' node. */
-	while (node->rb_parent && node == node->rb_parent->rb_right)
-		node = node->rb_parent;
-
-	return node->rb_parent;
-}
-
-struct rb_node *rb_prev(struct rb_node *node)
-{
-	if (node->rb_left) {
-		node = node->rb_left; 
-		while (node->rb_right)
-			node=node->rb_right;
-		return node;
-	}
-	while (node->rb_parent && node == node->rb_parent->rb_left)
-		node = node->rb_parent;
-
-	return node->rb_parent;
-}
-
 void rb_replace_node(struct rb_node *victim, struct rb_node *new, struct rb_root *root)
 {
 	struct rb_node *parent = victim->rb_parent;
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/a.out.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/a.out.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/a.out.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/a.out.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,12 @@
+/*
+ * uclinux/include/asm-armnommu/arch-atmel/a.out.h
+ *
+ */
+#ifndef __ASM_ARCH_A_OUT_H
+#define __ASM_ARCH_A_OUT_H
+
+#ifdef __KERNEL__
+#endif
+
+#endif
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/dma.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/dma.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/dma.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/dma.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,15 @@
+/*
+ * asm/arch-armnommu/arch-firefox/dma.h:
+ * Mindspeed 2001
+ * Hacked @Marvell 2002
+ */
+
+#ifndef __ASM_ARCH_DMA_H
+#define __ASM_ARCH_DMA_H
+
+#define MAX_DMA_ADDRESS		0x01000000
+#define MAX_DMA_CHANNELS        13
+#define arch_dma_init(dma_chan)
+
+
+#endif /* _ASM_ARCH_DMA_H */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/hardware.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/hardware.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/hardware.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/hardware.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,88 @@
+/*
+ * linux/include/asm-arm/arch-firefox/hardware.h
+ * for Marvell Firefox 88W8100
+ * 2002 Hedley Rainnie
+ */
+
+#ifndef __ASM_ARCH_HARDWARE_H
+#define __ASM_ARCH_HARDWARE_H
+
+
+/* 
+ * interrupts 
+ */
+
+
+#define INTBase_Addr  0x90008000
+
+#define Stat          0x0
+#define Msk           0x8
+#define Set 	      0x8
+#define Clr 	      0xc
+
+#define	FIREFOX_INT_MASK        (INTBase_Addr+Msk) 
+#define	FIREFOX_INT_ENABLE_CLR  (INTBase_Addr+Clr) 
+#define	FIREFOX_INT_ENABLE_SET  (INTBase_Addr+Set) 
+#define	FIREFOX_INT_STATUS      (INTBase_Addr+Stat)
+
+
+#define FIREFOX_TIMER_BASE 0x90009000
+#define FIREFOX_TIMER1_LENGTH	(FIREFOX_TIMER_BASE + 0x00)
+#define FIREFOX_TIMER2_LENGTH	(FIREFOX_TIMER_BASE + 0x04)
+#define FIREFOX_TIMER3_LENGTH	(FIREFOX_TIMER_BASE + 0x08)
+#define FIREFOX_TIMER4_LENGTH	(FIREFOX_TIMER_BASE + 0x0c)
+#define FIREFOX_TIMER_CONTROL	(FIREFOX_TIMER_BASE + 0x10)
+#define FIREFOX_TIMER1_VALUE	(FIREFOX_TIMER_BASE + 0x14)
+#define FIREFOX_TIMER2_VALUE	(FIREFOX_TIMER_BASE + 0x18)
+#define FIREFOX_TIMER3_VALUE	(FIREFOX_TIMER_BASE + 0x1C)
+#define FIREFOX_TIMER4_VALUE	(FIREFOX_TIMER_BASE + 0x18)
+#define FIREFOX_TIMER_INT_SOURCE  (FIREFOX_TIMER_BASE + 0x24)
+#define FIREFOX_TIMER_INT_MASK    (FIREFOX_TIMER_BASE + 0x28)
+
+/*
+ *****************************************************************************
+ *
+ *	Fast Ethernet Controller Interface Registers
+ *
+ *****************************************************************************
+ */
+
+#define firefox_reg_read(x) *(volatile unsigned int *) (0x80008000 + x)
+#define firefox_reg_write(x,y) *(volatile unsigned int *) (0x80008000 + x) = y;
+
+#define	FIREFOX_ENET_PHY_ADDR			0x000
+#define	FIREFOX_ENET_ESMIR			0x010
+
+#define	FIREFOX_ENET_E0PCR			0x400
+#define	FIREFOX_ENET_E0PCXR			0x408
+#define	FIREFOX_ENET_E0PCMR			0x410
+#define	FIREFOX_ENET_E0PSR			0x418
+#define	FIREFOX_ENET_E0SPR			0x420
+#define	FIREFOX_ENET_E0HTPR			0x428
+#define	FIREFOX_ENET_E0FCSAL			0x430
+#define	FIREFOX_ENET_E0FCSAH			0x438
+#define	FIREFOX_ENET_E0SDCR			0x440
+#define	FIREFOX_ENET_E0SDCMR			0x448
+#define	FIREFOX_ENET_E0ICR			0x450
+#define	FIREFOX_ENET_E0IW2CR			0x454
+#define	FIREFOX_ENET_E0IMR			0x458
+#define	FIREFOX_ENET_E0FRDP0			0x480
+#define	FIREFOX_ENET_E0FRDP1			0x484
+#define	FIREFOX_ENET_E0FRDP2			0x488
+#define	FIREFOX_ENET_E0FRDP3			0x48c
+#define	FIREFOX_ENET_E0CRDP0			0x4a0
+#define	FIREFOX_ENET_E0CRDP1			0x4a4
+#define	FIREFOX_ENET_E0CRDP2			0x4a8
+#define	FIREFOX_ENET_E0CRDP3			0x4ac
+#define	FIREFOX_ENET_E0CTDP0			0x4e0
+#define	FIREFOX_ENET_E0CTDP1			0x4e4
+#define	FIREFOX_ENET_0_DSCP2P0L			0x460
+#define	FIREFOX_ENET_0_DSCP2P0H			0x464
+#define	FIREFOX_ENET_0_DSCP2P1L			0x468
+#define	FIREFOX_ENET_0_DSCP2P1H			0x46c
+#define	FIREFOX_ENET_0_VPT2P			0x470
+#define	FIREFOX_ENET_0_MIB_CTRS			0x500
+
+#endif  /* _ASM_ARCH_HARDWARE_H */
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/ide.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/ide.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/ide.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/ide.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,45 @@
+/*
+ * linux/include/asm-arm/arch-sa1100/ide.h
+ *
+ * Copyright (c) 1998 Hugo Fiennes & Nicolas Pitre
+ *
+ * 18-aug-2000: Cleanup by Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *              Get rid of the special ide_init_hwif_ports() functions
+ *              and make a generalised function that can be used by all
+ *              architectures.
+ */
+
+#include <linux/config.h>
+#include <asm/irq.h>
+#include <asm/hardware.h>
+#include <asm/mach-types.h>
+
+
+/*
+ * Set up a hw structure for a specified data port, control port and IRQ.
+ * This should follow whatever the default interface uses.
+ */
+static __inline__ void
+ide_init_hwif_ports(hw_regs_t *hw, int data_port, int ctrl_port, int *irq)
+{
+#ifdef CONFIG_REVISIT
+#error Not sure what to do for ide_init_hwif_ports
+#endif
+}
+
+
+
+
+/*
+ * This registers the standard ports for this architecture with the IDE
+ * driver.
+ */
+static __inline__ void
+ide_init_default_hwifs(void)
+{
+#ifdef CONFIG_REVISIT
+#error Not sure what to do for ide_init_default_hwifs
+#endif
+}
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/io.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/io.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/io.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/io.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,40 @@
+/*
+ * linux/include/asm-armnommu/arch-dsc21/io.h
+ *
+ * Copyright (C) 1997-1999 Russell King
+ *
+ * Modifications:
+ *  06-12-1997	RMK	Created.
+ *  07-04-1999	RMK	Major cleanup
+ *  02-19-2001  gjm     Leveraged for armnommu/dsc21
+ */
+#ifndef __ASM_ARM_ARCH_IO_H
+#define __ASM_ARM_ARCH_IO_H
+
+/*
+ * kernel/resource.c uses this to initialize the global ioport_resource struct
+ * which is used in all calls to request_resource(), allocate_resource(), etc.
+ * --gmcnutt
+ */
+#define IO_SPACE_LIMIT 0xffffffff
+
+/*
+ * If we define __io then asm/io.h will take care of most of the inb & friends
+ * macros. It still leaves us some 16bit macros to deal with ourselves, though.
+ * We don't have PCI or ISA on the dsc21 so I dropped __mem_pci & __mem_isa.
+ * --gmcnutt
+ */
+#define PCIO_BASE 0
+#define __io(a) (PCIO_BASE + (a))
+#define __mem_pci(addr) addr
+#define __arch_getw(a) (*(volatile unsigned short *)(a))
+#define __arch_putw(v,a) (*(volatile unsigned short *)(a) = (v))
+
+/*
+ * Defining these two gives us ioremap for free. See asm/io.h.
+ * --gmcnutt
+ */
+#define iomem_valid_addr(iomem,sz) (1)
+#define iomem_to_phys(iomem) (iomem)
+
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/irq.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/irq.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/irq.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/irq.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,23 @@
+/*
+ * asm/arch-firefox/irq.h:
+ * 2002 Marvell
+ */
+
+#ifndef __ASM_ARCH_IRQ_H__
+#define __ASM_ARCH_IRQ_H__
+
+
+#include <asm/hardware.h>
+#include <asm/io.h>
+#include <asm/mach/irq.h>
+#include <asm/arch/irqs.h>
+
+#define fixup_irq(x) (x)
+
+extern void firefox_mask_irq(unsigned int irq);
+extern void firefox_unmask_irq(unsigned int irq);
+extern void firefox_mask_ack_irq(unsigned int irq);
+
+extern void irq_init_irq(void);
+
+#endif /* __ASM_ARCH_IRQ_H__ */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/irqs.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/irqs.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/irqs.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/irqs.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,48 @@
+/*
+ * asm/arch-firefox/irqs.h:
+ * 2002 Marvell
+ */
+#ifndef __ASM_ARCH_IRQS_H__
+#define __ASM_ARCH_IRQS_H__
+
+#define IRQ_FIRQ	0
+#define IRQ_PROG_IRQ	1
+#define IRQ_COMM_Rx	2
+#define IRQ_COMM_Tx	3
+#define IRQ_TIMER1	4
+#define IRQ_TIMER2	5
+#define IRQ_TIMER3	6
+#define IRQ_TIMER4	7
+#define IRQ_HOST	8
+#define IRQ_FE		9
+#define IRQ_WLAN	10
+#define IRQ_UART	11
+#define IRQ_GPIO	12
+#define IRQ_CLK_SER	13
+#define IRQ_PMU		14
+#define IRQ_DMA0	15
+#define IRQ_DMA1	16
+#define IRQ_AEU		17
+
+#define IRQ_MASK_FIRQ	(1 << IRQ_FIRQ)
+#define IRQ_MASK_PROG_IRQ	(1 << IRQ_PROG_IRQ)
+#define IRQ_MASK_COMM_Rx	(1 << IRQ_COMM_Rx)
+#define IRQ_MASK_COMM_Tx	(1 << IRQ_COMM_Tx)
+#define IRQ_MASK_TIMER1	(1 << IRQ_TIMER1)
+#define IRQ_MASK_TIMER2	(1 << IRQ_TIMER2)
+#define IRQ_MASK_TIMER3	(1 << IRQ_TIMER3)
+#define IRQ_MASK_TIMER4	(1 << IRQ_TIMER4)
+#define IRQ_MASK_HOST	(1 << IRQ_HOST)
+#define IRQ_MASK_FE		(1 << IRQ_FE)
+#define IRQ_MASK_WLAN	(1 << IRQ_WLAN)
+#define IRQ_MASK_UART	(1 << IRQ_UART)
+#define IRQ_MASK_GPIO	(1 << IRQ_GPIO)
+#define IRQ_MASK_CLK_SER	(1 << IRQ_CLK_SER)
+#define IRQ_MASK_PMU		(1 << IRQ_PMU)
+#define IRQ_MASK_DMA0	(1 << IRQ_DMA0)
+#define IRQ_MASK_DMA1	(1 << IRQ_DMA1)
+#define IRQ_MASK_AEU		(1 << IRQ_AEU)
+
+#define NR_IRQS           (IRQ_AEU + 1)
+
+#endif /* __ASM_ARCH_IRQS_H__ */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/keyboard.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/keyboard.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/keyboard.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/keyboard.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,39 @@
+/*
+ *  linux/include/asm-arm/arch-ti926/keyboard.h
+ *
+ *  Copyright (C) 2000 RidgeRun, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ *
+ *  Keyboard driver definitions for ARM
+ */
+#ifndef __ASM_ARM_ARCH_TI925_KEYBOARD_H
+#define __ASM_ARM_ARCH_TI925_KEYBOARD_H
+
+#if 0
+#define kbd_request_region
+#define kbd_write_command
+#define kbd_write_output
+#define kbd_read_status
+#define kbd_read_input
+#define aux_request_irq
+#define aux_free_irq
+#endif
+
+/*
+ * Required by drivers/char/keyboard.c. I took these from arch-arc.
+ * --gmcnutt
+ */
+#define kbd_setkeycode(sc,kc) (-EINVAL)
+#define kbd_getkeycode(sc) (-EINVAL)
+#define kbd_translate(sc,kcp,rm) ({ *(kcp) = (sc); 1; })
+#define kbd_unexpected_up(kc) (0200)
+#define kbd_leds(leds)
+#define kbd_init_hw()
+#define kbd_enable_irq() /* what irq? ;) --gmcnutt */
+#define kbd_disable_irq()
+
+
+#endif /* __ASM_ARM_ARCH_TI925_KEYBOARD_H */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/memory.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/memory.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/memory.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/memory.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,30 @@
+/*
+ * linux/include/asm-armnommu/arch-p52/memory.h
+ *
+ * Copyright (c) 1999 Nicolas Pitre <nico@cam.org>
+ * 2001 Mindspeed
+ */
+
+#ifndef __ASM_ARCH_MEMORY_H
+#define __ASM_ARCH_MEMORY_H
+
+/* #include <asm/page.h> */
+
+#define TASK_SIZE	(0x01a00000UL)
+#define TASK_SIZE_26	TASK_SIZE
+
+#define PHYS_OFFSET	(DRAM_BASE) 
+#define PAGE_OFFSET PHYS_OFFSET
+#define END_MEM     (DRAM_BASE + DRAM_SIZE)
+
+#define __virt_to_phys(vpage) ((unsigned long) (vpage))
+#define __phys_to_virt(ppage) ((void *) (ppage))
+#define __virt_to_bus(vpage) ((unsigned long) (vpage))
+#define __bus_to_virt(ppage) ((void *) (ppage))
+
+#endif
+
+
+
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/mmu.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/mmu.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/mmu.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/mmu.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,23 @@
+/*
+ * linux/include/asm-arm/arch-a5k/mmu.h
+ *
+ * Copyright (c) 1996 Russell King.
+ *
+ * Changelog:
+ *  22-11-1996	RMK	Created
+ */
+#ifndef __ASM_ARCH_MMU_H
+#define __ASM_ARCH_MMU_H
+
+#define __virt_to_phys__is_a_macro
+#define __virt_to_phys(vpage) ((unsigned long) (vpage))
+#define __phys_to_virt__is_a_macro
+#define __phys_to_virt(ppage) ((void *) (ppage))
+
+#define __virt_to_bus__is_a_macro
+#define __virt_to_bus(vpage) ((unsigned long) (vpage))
+#define __bus_to_virt__is_a_macro
+#define __bus_to_virt(ppage) ((void *) (ppage))
+
+#define __flush_entry_to_
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/param.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/param.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/param.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/param.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,6 @@
+#ifndef __ARCH_ASM_PARAM_H__
+#define __ARCH_ASM_PARAM_H__
+
+/* nothing for now */
+
+#endif /* __ARCH_ASM_PARAM_H__ */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/pcmcia.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/pcmcia.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/pcmcia.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/pcmcia.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,3 @@
+#ifdef CONFIG_REVISIT
+#error Do we need PCMCIA support?
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/processor.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/processor.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/processor.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/processor.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,15 @@
+/*
+ * uclinux/include/asm-armnommu/arch-atmel/mmu.h
+ *
+ */
+#ifndef __ASM_ARCH_PROCESSOR_H
+#define __ASM_ARCH_PROCESSOR_H
+
+#define EISA_bus 0
+#define EISA_bus__is_a_macro
+#define MCA_bus 0
+#define MCA_bus__is_a_macro
+
+#define TASK_SIZE (0x01a00000UL)
+
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/serial.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/serial.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/serial.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/serial.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,22 @@
+/*
+ *  linux/include/asm-armnommu/arch-firefox/serial.h
+ */
+#ifndef __ASM_ARCH_SERIAL_H
+#define __ASM_ARCH_SERIAL_H
+
+ /* Should be exported into a gloabal Firefox header file */
+#define FIREFOX_SERIAL_BASE_BAUD ( 8000000 / 16)
+#define FIREFOX_SERIAL_0_BASE_ADDR 0x8000c840
+#define FIREFOX_SERIAL_0_IRQ 11 /* Bit 11 */
+
+#define STD_COM_FLAGS (ASYNC_BOOT_AUTOCONF | ASYNC_SKIP_TEST)
+
+#define STD_SERIAL_PORT_DEFNS \
+{ 0, FIREFOX_SERIAL_BASE_BAUD, FIREFOX_SERIAL_0_BASE_ADDR, FIREFOX_SERIAL_0_IRQ, STD_COM_FLAGS, /* ttyS0 */\
+    iomem_base: (u8 *) FIREFOX_SERIAL_0_BASE_ADDR, /* IO mem base */ \
+    iomem_reg_shift: 2, \
+    io_type: SERIAL_IO_MEM },
+#define RS_TABLE_SIZE 2
+#define EXTRA_SERIAL_PORT_DEFNS
+
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/shmparam.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/shmparam.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/shmparam.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/shmparam.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,5 @@
+/*
+ * linux/include/asm-arm/arch-a5k/shmparam.h
+ *
+ * Copyright (c) 1996 Russell King.
+ */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/system.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/system.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/system.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/system.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,17 @@
+/*
+ * linux/include/asm-armnommu/arch-p52/system.h
+ * 2001 Mindspeed
+ */
+
+static inline void arch_idle(void)
+{
+	while (!current->need_resched && !hlt_counter)
+	  cpu_do_idle(IDLE_WAIT_SLOW);
+}
+
+extern inline void arch_reset(char mode)
+{
+  /* tbd */
+}
+
+ 
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/time.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/time.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/time.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/time.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,61 @@
+/*
+ * linux/include/asm-arm/arch-firefox/time.h
+ * 2002 Marvell
+ */
+
+#ifndef __ASM_ARCH_TIME_H__
+#define __ASM_ARCH_TIME_H__
+
+#include <asm/uaccess.h>
+#include <asm/io.h>
+#include <asm/hardware.h>
+#include <asm/arch/timex.h>
+
+extern struct irqaction timer_irq;
+
+#define KERNEL_TIMER 1
+
+#if (KERNEL_TIMER==0)
+#   define KERNEL_TIMER_IRQ_NUM IRQ_TC0
+#elif (KERNEL_TIMER==1)
+#   define KERNEL_TIMER_IRQ_NUM IRQ_TC1
+#elif (KERNEL_TIMER==2)
+#   define KERNEL_TIMER_IRQ_NUM IRQ_TC2
+#else
+#error Wierd -- KERNEL_TIMER is not defined or something....
+#endif
+
+extern unsigned long firefox_gettimeoffset(void);
+extern void firefox_timer_interrupt(int irq, void *dev_id, struct pt_regs *regs);
+
+extern /* __inline__ */ void setup_timer (void)
+{
+#if 0
+    outl(10000, FIREFOX_TIMER2_LENGTH);
+    outl((volatile unsigned int)(0xf << 4), FIREFOX_TIMER_CONTROL); /* load, int, active, continuous t1 */
+    outl((volatile unsigned int)(1<<1), FIREFOX_TIMER_INT_SOURCE); /* Intr source */
+    outl((volatile unsigned int)(1<<1), FIREFOX_TIMER_INT_MASK); /* Not marked as RW or as a mask in the doc, this is the mask... */
+    outl(IRQ_MASK_TIMER2, FIREFOX_INT_MASK);
+    /* gettimeoffset = firefox_gettimeoffset; */
+    timer_irq.handler = firefox_timer_interrupt;
+    setup_arm_irq(IRQ_TIMER2, &timer_irq);
+#else
+    outl(10, FIREFOX_TIMER1_LENGTH);
+    outl((volatile unsigned int)(0xf), FIREFOX_TIMER_CONTROL); /* load, int, active, continuous t1 */
+    outl((volatile unsigned int)(1<<0), FIREFOX_TIMER_INT_SOURCE); /* Intr source */
+    outl((volatile unsigned int)(1<<0), FIREFOX_TIMER_INT_MASK); /* Not marked as RW or as a mask in the doc, this is the mask... */
+    outl(IRQ_MASK_TIMER1, FIREFOX_INT_MASK);
+    /* gettimeoffset = firefox_gettimeoffset; */
+    timer_irq.handler = firefox_timer_interrupt;
+    setup_arm_irq(IRQ_TIMER1, &timer_irq);
+
+#endif
+    
+}
+
+#endif /* __ASM_ARCH_TIME_H__ */
+
+
+
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/timex.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/timex.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/timex.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/timex.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,24 @@
+/*
+ * timex.h:
+ * 2001 Mindspeed
+ */
+#ifndef __ASM_ARCH_TIMEX_H__
+#define __ASM_ARCH_TIMEX_H__
+
+#define CLOCK_TICK_RATE	   0x270f
+
+#endif /* __ASM_ARCH_TIMEX_H__ */
+
+
+
+
+
+
+
+
+
+
+
+
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/uncompress.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/uncompress.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/uncompress.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/uncompress.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,56 @@
+/*
+ * asm/arch/uncompress.c:
+ *         Optional routines to aid in debugging the decompression phase
+ *         of kernel boot.
+ * copyright:
+ *         (C) 2001 RidgeRun, Inc. (http://www.ridgerun.com)
+ * author: Gordon McNutt <gmcnutt@ridgerun.com>
+ *
+ * This program is free software; you can redistribute  it and/or modify it
+ * under  the terms of  the GNU General  Public License as published by the
+ * Free Software Foundation;  either version 2 of the  License, or (at your
+ * option) any later version.
+ *
+ * THIS  SOFTWARE  IS PROVIDED   ``AS  IS'' AND   ANY  EXPRESS OR IMPLIED
+ * WARRANTIES,   INCLUDING, BUT NOT  LIMITED  TO, THE IMPLIED WARRANTIES OF
+ * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN
+ * NO  EVENT  SHALL   THE AUTHOR  BE    LIABLE FOR ANY   DIRECT, INDIRECT,
+ * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
+ * NOT LIMITED   TO, PROCUREMENT OF  SUBSTITUTE GOODS  OR SERVICES; LOSS OF
+ * USE, DATA,  OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
+ * ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
+ * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * You should have received a copy of the  GNU General Public License along
+ * with this program; if not, write  to the Free Software Foundation, Inc.,
+ * 675 Mass Ave, Cambridge, MA 02139, USA.
+ *
+ */
+
+/*
+ * This is used by arch/armnommu/boot/compressed/misc.c to write progress info
+ * out the serial port so that the user can see debug messages up to the point
+ * where the kernel is decompressed. The STANDALONE_DEBUG macro chooses between
+ * this and the standard printf. Punt.
+ * --gmcnutt
+ */
+static void puts(const char *s) {
+  unsigned int i,j;
+  for (i = 0 ; s[i] ; i++) {
+    *(char *)0x8000c840 = s[i];
+    for (j = 0 ; j < 10000 ; j++) {};
+  }
+}
+
+/*
+ * Not sure what this is for. Probably an optional watchdog to check if the
+ * decompress got hung so we can warn the user. Punt.
+ */
+#define arch_decomp_wdog()
+
+/*
+ * If we need to do some setup prior to decompression (like initializing the
+ * UART if we want to use puts() above) then we define it here. Punt.
+ */
+#define arch_decomp_setup()
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/vmalloc.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/vmalloc.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-firefox/vmalloc.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-firefox/vmalloc.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,33 @@
+/*
+ *  linux/include/asm-arm/arch-dsc21/vmalloc.h
+ *
+ *  Copyright (C) 2000 Russell King.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+/*
+ * Just any arbitrary offset to the start of the vmalloc VM area: the
+ * current 8MB value just means that there will be a 8MB "hole" after the
+ * physical memory until the kernel virtual memory starts.  That means that
+ * any out-of-bounds memory accesses will hopefully be caught.
+ * The vmalloc() routines leaves a hole of 4kB between each vmalloced
+ * area for the same reason. ;)
+ */
+#define VMALLOC_OFFSET	  (8*1024*1024)
+#define VMALLOC_START	  (((unsigned long)high_memory + VMALLOC_OFFSET) & ~(VMALLOC_OFFSET-1))
+#define VMALLOC_VMADDR(x) ((unsigned long)(x))
+#define VMALLOC_END       (PAGE_OFFSET + 0x10000000)
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/a.out.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/a.out.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/a.out.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/a.out.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,12 @@
+/*
+ * uclinux/include/asm-armnommu/arch-libertas/a.out.h
+ *
+ */
+#ifndef __ASM_ARCH_A_OUT_H
+#define __ASM_ARCH_A_OUT_H
+
+#ifdef __KERNEL__
+#endif
+
+#endif
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/dma.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/dma.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/dma.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/dma.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,15 @@
+/*
+ * asm/arch-armnommu/arch-libertas/dma.h:
+ * Mindspeed 2001
+ * Hacked @Marvell 2003
+ */
+
+#ifndef __ASM_ARCH_DMA_H
+#define __ASM_ARCH_DMA_H
+
+#define MAX_DMA_ADDRESS		0x01000000
+#define MAX_DMA_CHANNELS        13
+#define arch_dma_init(dma_chan)
+
+
+#endif /* _ASM_ARCH_DMA_H */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/hardware.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/hardware.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/hardware.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/hardware.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,90 @@
+/*
+ * linux/include/asm-arm/arch-libertas/hardware.h
+ * for Marvell Firefox 88W8100
+ * 2002 Hedley Rainnie
+ */
+
+#ifndef __ASM_ARCH_HARDWARE_H
+#define __ASM_ARCH_HARDWARE_H
+
+#define HARD_RESET_NOW()
+
+/* 
+ * interrupts 
+ */
+
+
+#define INTBase_Addr  0x90008000
+
+#define Stat          0x0
+#define Msk           0x8
+#define Set 	      0x8
+#define Clr 	      0xc
+
+#define	LIBERTAS_INT_MASK        (INTBase_Addr+Msk) 
+#define	LIBERTAS_INT_ENABLE_CLR  (INTBase_Addr+Clr) 
+#define	LIBERTAS_INT_ENABLE_SET  (INTBase_Addr+Set) 
+#define	LIBERTAS_INT_STATUS      (INTBase_Addr+Stat)
+
+
+#define LIBERTAS_TIMER_BASE      0x90009000
+
+#define LIBERTAS_TIMER1_LENGTH   	(LIBERTAS_TIMER_BASE + 0x00)
+#define LIBERTAS_TIMER2_LENGTH   	(LIBERTAS_TIMER_BASE + 0x04)
+#define LIBERTAS_TIMER3_LENGTH   	(LIBERTAS_TIMER_BASE + 0x08)
+#define LIBERTAS_TIMER4_LENGTH   	(LIBERTAS_TIMER_BASE + 0x0c)
+#define LIBERTAS_TIMER_CONTROL   	(LIBERTAS_TIMER_BASE + 0x10)
+#define LIBERTAS_TIMER1_VALUE    	(LIBERTAS_TIMER_BASE + 0x14)
+#define LIBERTAS_TIMER2_VALUE    	(LIBERTAS_TIMER_BASE + 0x18)
+#define LIBERTAS_TIMER3_VALUE    	(LIBERTAS_TIMER_BASE + 0x1C)
+#define LIBERTAS_TIMER4_VALUE    	(LIBERTAS_TIMER_BASE + 0x18)
+#define LIBERTAS_TIMER_INT_SOURCE	(LIBERTAS_TIMER_BASE + 0x24)
+#define LIBERTAS_TIMER_INT_MASK  	(LIBERTAS_TIMER_BASE + 0x28)
+
+/*
+ *****************************************************************************
+ *
+ *	Fast Ethernet Controller Interface Registers
+ *
+ *****************************************************************************
+ */
+
+#define libertas_reg_read(x)   	*(volatile unsigned int *)(0x80008000 + x)
+#define libertas_reg_write(x,y) *(volatile unsigned int *)(0x80008000 + x) = y;
+
+#define	LIBERTAS_ENET_PHY_ADDR  		0x000
+#define	LIBERTAS_ENET_ESMIR     		0x010
+
+#define	LIBERTAS_ENET_E0PCR     		0x400
+#define	LIBERTAS_ENET_E0PCXR    		0x408
+#define	LIBERTAS_ENET_E0PCMR    		0x410
+#define	LIBERTAS_ENET_E0PSR     		0x418
+#define	LIBERTAS_ENET_E0SPR     		0x420
+#define	LIBERTAS_ENET_E0HTPR    		0x428
+#define	LIBERTAS_ENET_E0FCSAL   		0x430
+#define	LIBERTAS_ENET_E0FCSAH   		0x438
+#define	LIBERTAS_ENET_E0SDCR    		0x440
+#define	LIBERTAS_ENET_E0SDCMR   		0x448
+#define	LIBERTAS_ENET_E0ICR     		0x450
+#define	LIBERTAS_ENET_E0IW2CR   		0x454
+#define	LIBERTAS_ENET_E0IMR     		0x458
+#define	LIBERTAS_ENET_E0FRDP0   		0x480
+#define	LIBERTAS_ENET_E0FRDP1   		0x484
+#define	LIBERTAS_ENET_E0FRDP2   		0x488
+#define	LIBERTAS_ENET_E0FRDP3   		0x48c
+#define	LIBERTAS_ENET_E0CRDP0   		0x4a0
+#define	LIBERTAS_ENET_E0CRDP1   		0x4a4
+#define	LIBERTAS_ENET_E0CRDP2   		0x4a8
+#define	LIBERTAS_ENET_E0CRDP3   		0x4ac
+#define	LIBERTAS_ENET_E0CTDP0   		0x4e0
+#define	LIBERTAS_ENET_E0CTDP1   		0x4e4
+#define	LIBERTAS_ENET_0_DSCP2P0L		0x460
+#define	LIBERTAS_ENET_0_DSCP2P0H		0x464
+#define	LIBERTAS_ENET_0_DSCP2P1L		0x468
+#define	LIBERTAS_ENET_0_DSCP2P1H		0x46c
+#define	LIBERTAS_ENET_0_VPT2P   		0x470
+#define	LIBERTAS_ENET_0_MIB_CTRS		0x500
+
+#endif  /* _ASM_ARCH_HARDWARE_H */
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/ide.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/ide.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/ide.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/ide.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,46 @@
+/*
+ * linux/include/asm-arm/libertas/ide.h
+ *
+ * Copyright (c) 1998 Hugo Fiennes & Nicolas Pitre
+ *
+ * 18-aug-2000: Cleanup by Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *              Get rid of the special ide_init_hwif_ports() functions
+ *              and make a generalised function that can be used by all
+ *              architectures.
+ * Hacked @Marvell 2002 
+ */
+
+#include <linux/config.h>
+#include <asm/irq.h>
+#include <asm/hardware.h>
+#include <asm/mach-types.h>
+
+
+/*
+ * Set up a hw structure for a specified data port, control port and IRQ.
+ * This should follow whatever the default interface uses.
+ */
+static __inline__ void
+ide_init_hwif_ports(hw_regs_t *hw, int data_port, int ctrl_port, int *irq)
+{
+#ifdef CONFIG_REVISIT
+#error Not sure what to do for ide_init_hwif_ports
+#endif
+}
+
+
+
+
+/*
+ * This registers the standard ports for this architecture with the IDE
+ * driver.
+ */
+static __inline__ void
+ide_init_default_hwifs(void)
+{
+#ifdef CONFIG_REVISIT
+#error Not sure what to do for ide_init_default_hwifs
+#endif
+}
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/io.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/io.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/io.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/io.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,41 @@
+/*
+ * linux/include/asm-armnommu/arch-libertas/io.h
+ *
+ * Copyright (C) 1997-1999 Russell King
+ *
+ * Modifications:
+ *  06-12-1997	RMK	Created.
+ *  07-04-1999	RMK	Major cleanup
+ *  02-19-2001  gjm     Leveraged for armnommu/dsc21
+ * Hacked @Marvell 2003  
+ */
+#ifndef __ASM_ARM_ARCH_IO_H
+#define __ASM_ARM_ARCH_IO_H
+
+/*
+ * kernel/resource.c uses this to initialize the global ioport_resource struct
+ * which is used in all calls to request_resource(), allocate_resource(), etc.
+ * --gmcnutt
+ */
+#define IO_SPACE_LIMIT 0xffffffff
+
+/*
+ * If we define __io then asm/io.h will take care of most of the inb & friends
+ * macros. It still leaves us some 16bit macros to deal with ourselves, though.
+ * We don't have PCI or ISA on the dsc21 so I dropped __mem_pci & __mem_isa.
+ * --gmcnutt
+ */
+#define PCIO_BASE 0
+#define __io(a) (PCIO_BASE + (a))
+#define __mem_pci(addr) addr
+#define __arch_getw(a) (*(volatile unsigned short *)(a))
+#define __arch_putw(v,a) (*(volatile unsigned short *)(a) = (v))
+
+/*
+ * Defining these two gives us ioremap for free. See asm/io.h.
+ * --gmcnutt
+ */
+#define iomem_valid_addr(iomem,sz) (1)
+#define iomem_to_phys(iomem) (iomem)
+
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/irq.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/irq.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/irq.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/irq.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,23 @@
+/*
+ * asm/arch-libertas/irq.h:
+ * 2002 Marvell
+ */
+
+#ifndef __ASM_ARCH_IRQ_H__
+#define __ASM_ARCH_IRQ_H__
+
+
+#include <asm/hardware.h>
+#include <asm/io.h>
+#include <asm/mach/irq.h>
+#include <asm/arch/irqs.h>
+
+#define fixup_irq(x) (x)
+
+extern void libertas_mask_irq(unsigned int irq);
+extern void libertas_unmask_irq(unsigned int irq);
+extern void libertas_mask_ack_irq(unsigned int irq);
+
+extern void irq_init_irq(void);
+
+#endif /* __ASM_ARCH_IRQ_H__ */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/irqs.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/irqs.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/irqs.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/irqs.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,52 @@
+/*
+ * asm/arch-libertas/irqs.h:
+ * 2002 Marvell
+ */
+#ifndef __ASM_ARCH_IRQS_H__
+#define __ASM_ARCH_IRQS_H__
+
+#define IRQ_FIRQ	0
+#define IRQ_PROG_IRQ	1
+#define IRQ_COMM_Rx	2
+#define IRQ_COMM_Tx	3
+#define IRQ_TIMER1	4
+#define IRQ_TIMER2	5
+#define IRQ_TIMER3	6
+#define IRQ_TIMER4	7
+#define IRQ_HOST	8
+#define IRQ_FE		9
+#define IRQ_WLAN	10
+#define IRQ_UART	11
+#define IRQ_GPIO	12
+#define IRQ_CLK_SER	13
+#define IRQ_PMU		14
+#define IRQ_DMA0	15
+#define IRQ_DMA1	16
+#define IRQ_AEU		17
+#define IRQ_DMA2	18
+#define IRQ_DMA3	19
+
+#define IRQ_MASK_FIRQ    	(1 << IRQ_FIRQ)
+#define IRQ_MASK_PROG_IRQ	(1 << IRQ_PROG_IRQ)
+#define IRQ_MASK_COMM_Rx 	(1 << IRQ_COMM_Rx)
+#define IRQ_MASK_COMM_Tx 	(1 << IRQ_COMM_Tx)
+#define IRQ_MASK_TIMER1  	(1 << IRQ_TIMER1)
+#define IRQ_MASK_TIMER2  	(1 << IRQ_TIMER2)
+#define IRQ_MASK_TIMER3  	(1 << IRQ_TIMER3)
+#define IRQ_MASK_TIMER4  	(1 << IRQ_TIMER4)
+#define IRQ_MASK_HOST    	(1 << IRQ_HOST)
+#define IRQ_MASK_FE      	(1 << IRQ_FE)
+#define IRQ_MASK_WLAN    	(1 << IRQ_WLAN)
+#define IRQ_MASK_UART    	(1 << IRQ_UART)
+#define IRQ_MASK_GPIO    	(1 << IRQ_GPIO)
+#define IRQ_MASK_CLK_SER 	(1 << IRQ_CLK_SER)
+#define IRQ_MASK_PMU     	(1 << IRQ_PMU)
+#define IRQ_MASK_DMA0    	(1 << IRQ_DMA0)
+#define IRQ_MASK_DMA1    	(1 << IRQ_DMA1)
+#define IRQ_MASK_AEU     	(1 << IRQ_AEU)
+#define IRQ_MASK_DMA2    	(1 << IRQ_DMA2)
+#define IRQ_MASK_DMA3    	(1 << IRQ_DMA3)
+
+#define NR_IRQS          (IRQ_DMA3 + 1)
+
+#endif /* __ASM_ARCH_IRQS_H__ */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/keyboard.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/keyboard.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/keyboard.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/keyboard.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,40 @@
+/*
+ *  linux/include/asm-arm/arch-libertas/keyboard.h
+ *
+ *  Copyright (C) 2000 RidgeRun, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ *
+ *  Keyboard driver definitions for ARM
+ * Hacked @Marvell 2002 
+ */
+#ifndef __ASM_ARM_ARCH_TI925_KEYBOARD_H
+#define __ASM_ARM_ARCH_TI925_KEYBOARD_H
+
+#if 0
+#define kbd_request_region
+#define kbd_write_command
+#define kbd_write_output
+#define kbd_read_status
+#define kbd_read_input
+#define aux_request_irq
+#define aux_free_irq
+#endif
+
+/*
+ * Required by drivers/char/keyboard.c. I took these from arch-arc.
+ * --gmcnutt
+ */
+#define kbd_setkeycode(sc,kc) (-EINVAL)
+#define kbd_getkeycode(sc) (-EINVAL)
+#define kbd_translate(sc,kcp,rm) ({ *(kcp) = (sc); 1; })
+#define kbd_unexpected_up(kc) (0200)
+#define kbd_leds(leds)
+#define kbd_init_hw()
+#define kbd_enable_irq() /* what irq? ;) --gmcnutt */
+#define kbd_disable_irq()
+
+
+#endif /* __ASM_ARM_ARCH_TI925_KEYBOARD_H */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/memory.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/memory.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/memory.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/memory.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,31 @@
+/*
+ * linux/include/asm-armnommu/arch-libertas/memory.h
+ *
+ * Copyright (c) 1999 Nicolas Pitre <nico@cam.org>
+ * 2001 Mindspeed
+ * Hacked @Marvell 2003  
+ */
+
+#ifndef __ASM_ARCH_MEMORY_H
+#define __ASM_ARCH_MEMORY_H
+
+/* #include <asm/page.h> */
+
+#define TASK_SIZE   	(0x01a00000UL)
+#define TASK_SIZE_26	TASK_SIZE
+
+#define PHYS_OFFSET 	(DRAM_BASE) 
+#define PAGE_OFFSET 	PHYS_OFFSET
+#define END_MEM     	(DRAM_BASE + DRAM_SIZE)
+
+#define __virt_to_phys(vpage) ((unsigned long) (vpage))
+#define __phys_to_virt(ppage) ((void *) (ppage))
+#define __virt_to_bus(vpage) ((unsigned long) (vpage))
+#define __bus_to_virt(ppage) ((void *) (ppage))
+
+#endif
+
+
+
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/param.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/param.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/param.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/param.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,10 @@
+/*
+ * uclinux/include/asm-armnommu/arch-libertas/a.out.h
+ *
+ */ 
+#ifndef __ARCH_ASM_PARAM_H__
+#define __ARCH_ASM_PARAM_H__
+
+/* nothing for now */
+
+#endif /* __ARCH_ASM_PARAM_H__ */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/pcmcia.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/pcmcia.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/pcmcia.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/pcmcia.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,7 @@
+/*
+ * uclinux/include/asm-armnommu/arch-libertas/a.out.h
+ *
+ */ 
+#ifdef CONFIG_REVISIT
+#error Do we need PCMCIA support?
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/processor.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/processor.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/processor.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/processor.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,15 @@
+/*
+ * uclinux/include/asm-armnommu/arch-libertas/mmu.h
+ *
+ */
+#ifndef __ASM_ARCH_PROCESSOR_H
+#define __ASM_ARCH_PROCESSOR_H
+
+#define EISA_bus 0
+#define EISA_bus__is_a_macro
+#define MCA_bus 0
+#define MCA_bus__is_a_macro
+
+#define TASK_SIZE (0x01a00000UL)
+
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/serial.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/serial.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/serial.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/serial.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,22 @@
+/*
+ *  linux/include/asm-armnommu/arch-libertas/serial.h
+ */
+#ifndef __ASM_ARCH_SERIAL_H
+#define __ASM_ARCH_SERIAL_H
+
+ /* Should be exported into a gloabal Libertas header file */
+#define LIBERTAS_SERIAL_BASE_BAUD       (8000000 / 16)
+#define LIBERTAS_SERIAL_0_BASE_ADDR     0x8000c840
+#define LIBERTAS_SERIAL_0_IRQ           11 /* Bit 11 */
+
+#define STD_COM_FLAGS (ASYNC_BOOT_AUTOCONF | ASYNC_SKIP_TEST)
+
+#define STD_SERIAL_PORT_DEFNS \
+{ 0, LIBERTAS_SERIAL_BASE_BAUD, LIBERTAS_SERIAL_0_BASE_ADDR, LIBERTAS_SERIAL_0_IRQ, STD_COM_FLAGS, /* ttyS0 */\
+    iomem_base: (u8 *) LIBERTAS_SERIAL_0_BASE_ADDR, /* IO mem base */ \
+    iomem_reg_shift: 2, \
+    io_type: SERIAL_IO_MEM },
+#define RS_TABLE_SIZE 2
+#define EXTRA_SERIAL_PORT_DEFNS
+
+#endif
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/shmparam.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/shmparam.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/shmparam.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/shmparam.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,7 @@
+/*
+ * linux/include/asm-arm/libertas/shmparam.h
+ *
+ * Copyright (c) 1996 Russell King.
+ *
+ * Hacked @Marvell 2003 
+ */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/system.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/system.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/system.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/system.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,36 @@
+/*
+ * linux/include/asm-armnommu/arch-libertas/system.h
+ * 2001 Mindspeed
+ * Hacked @Marvell 2003
+ */
+
+#define ARM_RESET_VECTOR  0xFFFF0000
+
+static inline void arch_idle(void)
+{
+	while (!current->need_resched && !hlt_counter)
+	  cpu_do_idle(IDLE_WAIT_SLOW);
+}
+
+extern inline void arch_reset(char mode)
+{
+
+	void (*reset_fun)(void);
+
+	__asm__ __volatile__ (
+	"mov    ip, #0\n"
+	"mcr    p15, 0, ip, c7, c14, 0\n"
+	"mrc    p15, 0, ip, c1, c0, 0\n"
+	"bic    ip, ip, #0x000f\n"
+	"bic    ip, ip, #0x2100\n"
+	"mcr    p15, 0, ip, c1, c0, 0\n");
+
+	reset_fun = (void (*)) ARM_RESET_VECTOR;
+
+	reset_fun();
+
+	/* should not come here
+	 */
+}
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/time.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/time.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/time.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/time.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,61 @@
+/*
+ * linux/include/asm-arm/arch-libertas/time.h
+ * 2002 Marvell
+ */
+
+#ifndef __ASM_ARCH_TIME_H__
+#define __ASM_ARCH_TIME_H__
+
+#include <asm/uaccess.h>
+#include <asm/io.h>
+#include <asm/hardware.h>
+#include <asm/arch/timex.h>
+
+extern struct irqaction timer_irq;
+
+#define KERNEL_TIMER 1
+
+#if (KERNEL_TIMER==0)
+#   define KERNEL_TIMER_IRQ_NUM IRQ_TC0
+#elif (KERNEL_TIMER==1)
+#   define KERNEL_TIMER_IRQ_NUM IRQ_TC1
+#elif (KERNEL_TIMER==2)
+#   define KERNEL_TIMER_IRQ_NUM IRQ_TC2
+#else
+#error Wierd -- KERNEL_TIMER is not defined or something....
+#endif
+
+extern unsigned long libertas_gettimeoffset(void);
+extern void libertas_timer_interrupt(int irq, void *dev_id, struct pt_regs *regs);
+
+extern /* __inline__ */ void setup_timer (void)
+{
+#if 0
+    outl(10000, LIBERTAS_TIMER2_LENGTH);
+    outl((volatile unsigned int)(0xf << 4), LIBERTAS_TIMER_CONTROL); /* load, int, active, continuous t1 */
+    outl((volatile unsigned int)(1<<1), LIBERTAS_TIMER_INT_SOURCE);  /* Intr source */
+    outl((volatile unsigned int)(1<<1), LIBERTAS_TIMER_INT_MASK);    /* Not marked as RW or as a mask in the doc, this is the mask... */
+    outl(IRQ_MASK_TIMER2, LIBERTAS_INT_MASK);
+    /* gettimeoffset = libertas_gettimeoffset; */
+    timer_irq.handler = libertas_timer_interrupt;
+    setup_arm_irq(IRQ_TIMER2, &timer_irq);
+#else
+    outl(10, LIBERTAS_TIMER1_LENGTH);
+    outl((volatile unsigned int)(0xf), LIBERTAS_TIMER_CONTROL);      /* load, int, active, continuous t1 */
+    outl((volatile unsigned int)(1<<0), LIBERTAS_TIMER_INT_SOURCE);  /* Intr source */
+    outl((volatile unsigned int)(1<<0), LIBERTAS_TIMER_INT_MASK);    /* Not marked as RW or as a mask in the doc, this is the mask... */
+    outl(IRQ_MASK_TIMER1, LIBERTAS_INT_MASK);
+    /* gettimeoffset = libertas_gettimeoffset; */
+    timer_irq.handler = libertas_timer_interrupt;
+    setup_arm_irq(IRQ_TIMER1, &timer_irq);
+
+#endif
+    
+}
+
+#endif /* __ASM_ARCH_TIME_H__ */
+
+
+
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/timex.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/timex.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/timex.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/timex.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,24 @@
+/*
+ * uclinux/include/asm-armnommu/arch-libertas/timex.h
+ *
+ */ 
+#ifndef __ASM_ARCH_TIMEX_H__
+#define __ASM_ARCH_TIMEX_H__
+
+#define CLOCK_TICK_RATE	   0x270f
+
+#endif /* __ASM_ARCH_TIMEX_H__ */
+
+
+
+
+
+
+
+
+
+
+
+
+
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/uncompress.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/uncompress.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/uncompress.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/uncompress.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,56 @@
+/*
+ * linux/include/asm-arm/arch-libertas/uncompress.h
+ *         Optional routines to aid in debugging the decompression phase
+ *         of kernel boot.
+ * copyright:
+ *         (C) 2001 RidgeRun, Inc. (http://www.ridgerun.com)
+ * author: Gordon McNutt <gmcnutt@ridgerun.com>
+ *
+ * This program is free software; you can redistribute  it and/or modify it
+ * under  the terms of  the GNU General  Public License as published by the
+ * Free Software Foundation;  either version 2 of the  License, or (at your
+ * option) any later version.
+ *
+ * THIS  SOFTWARE  IS PROVIDED   ``AS  IS'' AND   ANY  EXPRESS OR IMPLIED
+ * WARRANTIES,   INCLUDING, BUT NOT  LIMITED  TO, THE IMPLIED WARRANTIES OF
+ * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN
+ * NO  EVENT  SHALL   THE AUTHOR  BE    LIABLE FOR ANY   DIRECT, INDIRECT,
+ * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
+ * NOT LIMITED   TO, PROCUREMENT OF  SUBSTITUTE GOODS  OR SERVICES; LOSS OF
+ * USE, DATA,  OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
+ * ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
+ * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * You should have received a copy of the  GNU General Public License along
+ * with this program; if not, write  to the Free Software Foundation, Inc.,
+ * 675 Mass Ave, Cambridge, MA 02139, USA.
+ *
+ */
+
+/*
+ * This is used by arch/armnommu/boot/compressed/misc.c to write progress info
+ * out the serial port so that the user can see debug messages up to the point
+ * where the kernel is decompressed. The STANDALONE_DEBUG macro chooses between
+ * this and the standard printf. Punt.
+ * --gmcnutt
+ */
+static void puts(const char *s) {
+  unsigned int i,j;
+  for (i = 0 ; s[i] ; i++) {
+    *(char *)0x8000c840 = s[i];
+    for (j = 0 ; j < 10000 ; j++) {};
+  }
+}
+
+/*
+ * Not sure what this is for. Probably an optional watchdog to check if the
+ * decompress got hung so we can warn the user. Punt.
+ */
+#define arch_decomp_wdog()
+
+/*
+ * If we need to do some setup prior to decompression (like initializing the
+ * UART if we want to use puts() above) then we define it here. Punt.
+ */
+#define arch_decomp_setup()
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/vmalloc.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/vmalloc.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/arch-libertas/vmalloc.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/arch-libertas/vmalloc.h	2006-09-10 12:49:22.000000000 +0300
@@ -0,0 +1,33 @@
+/*
+ *  linux/include/asm-arm/arch-libertas/vmalloc.h
+ *
+ *  Copyright (C) 2000 Russell King.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+/*
+ * Just any arbitrary offset to the start of the vmalloc VM area: the
+ * current 8MB value just means that there will be a 8MB "hole" after the
+ * physical memory until the kernel virtual memory starts.  That means that
+ * any out-of-bounds memory accesses will hopefully be caught.
+ * The vmalloc() routines leaves a hole of 4kB between each vmalloced
+ * area for the same reason. ;)
+ */
+#define VMALLOC_OFFSET	  (8*1024*1024)
+#define VMALLOC_START	  (((unsigned long)high_memory + VMALLOC_OFFSET) & ~(VMALLOC_OFFSET-1))
+#define VMALLOC_VMADDR(x) ((unsigned long)(x))
+#define VMALLOC_END       (PAGE_OFFSET + 0x10000000)
+
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/bitops.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/bitops.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/bitops.h	2003-06-25 15:47:23.000000000 +0300
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/bitops.h	2006-09-10 13:21:06.000000000 +0300
@@ -118,6 +118,7 @@
  */
 
 #define ffs(x) generic_ffs(x)
+#define __ffs(x) (ffs(x) - 1)
 
 #define ext2_set_bit			test_and_set_bit
 #define ext2_clear_bit			test_and_clear_bit
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/bug.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/bug.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/bug.h	1970-01-01 02:00:00.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/bug.h	2006-09-10 14:52:56.000000000 +0300
@@ -0,0 +1 @@
+/* required by mtd */
diff -bBurN linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/proc-fns.h linux-2.4.32-uc0-wl530g/include/asm-armnommu/proc-fns.h
--- linux-2.4.32-uc0-mtdcvs/include/asm-armnommu/proc-fns.h	2001-11-19 14:40:01.000000000 +0200
+++ linux-2.4.32-uc0-wl530g/include/asm-armnommu/proc-fns.h	2006-09-10 12:49:22.000000000 +0300
@@ -76,6 +76,14 @@
 #   define CPU_NAME arm940
 #  endif
 # endif
+# ifdef CONFIG_CPU_ARM946
+#  ifdef CPU_NAME
+#   undef  MULTI_CPU
+#   define MULTI_CPU
+#  else
+#   define CPU_NAME arm946
+#  endif
+# endif
 # ifdef CONFIG_CPU_SA110
 #  ifdef CPU_NAME
 #   undef  MULTI_CPU
